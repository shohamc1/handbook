<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DeFiChain Handbook</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="prelude.html">Prelude</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Introduction</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">1.1.</strong> Getting Started</div></li></ol></li><li class="chapter-item expanded "><a href="concepts.html"><strong aria-hidden="true">2.</strong> Concepts</a></li><li class="chapter-item expanded "><a href="proto.html"><strong aria-hidden="true">3.</strong> Protocol and Network</a></li><li class="chapter-item expanded "><a href="pinkpaper/index.html"><strong aria-hidden="true">4.</strong> Pink Paper</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pinkpaper/emission/index.html"><strong aria-hidden="true">4.1.</strong> Emission</a></li><li class="chapter-item expanded "><a href="pinkpaper/fees/index.html"><strong aria-hidden="true">4.2.</strong> Fees</a></li><li class="chapter-item expanded "><a href="pinkpaper/futures/index.html"><strong aria-hidden="true">4.3.</strong> Futures</a></li><li class="chapter-item expanded "><a href="pinkpaper/governance/index.html"><strong aria-hidden="true">4.4.</strong> Governance</a></li><li class="chapter-item expanded "><a href="pinkpaper/interchain-exchange/index.html"><strong aria-hidden="true">4.5.</strong> Interchain Exchange</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pinkpaper/interchain-exchange/fees.html"><strong aria-hidden="true">4.5.1.</strong> Fees</a></li></ol></li><li class="chapter-item expanded "><a href="pinkpaper/loan/index.html"><strong aria-hidden="true">4.6.</strong> Loan</a></li><li class="chapter-item expanded "><a href="pinkpaper/operator/index.html"><strong aria-hidden="true">4.7.</strong> Operator</a></li><li class="chapter-item expanded "><a href="pinkpaper/price-oracle/index.html"><strong aria-hidden="true">4.8.</strong> Price Oracle</a></li></ol></li><li class="chapter-item expanded "><a href="defid.html"><strong aria-hidden="true">5.</strong> Reference Node - defid</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/wallet.html"><strong aria-hidden="true">5.1.</strong> Using a Wallet</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.</strong> Drafts</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="drafts/releases.html"><strong aria-hidden="true">5.2.1.</strong> Releases</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.2.</strong> Code Conventions</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.3.</strong> Git Conventions</div></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Applications</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> Wallets</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Resources</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DeFiChain Handbook</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/DeFiCh/handbook/tree/main/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="prelude"><a class="header" href="#prelude">Prelude</a></h1>
<h2 id="whats-the-goal-of-this-handbook"><a class="header" href="#whats-the-goal-of-this-handbook">What's the goal of this handbook?</a></h2>
<p>To slowly start building this up:</p>
<ul>
<li>Critical docs: How to update for exchanges, reindexes etc.</li>
<li>Standard practices for coding, git, things like how to add a new data structure, add rpc, etc</li>
<li>Testing: how to write a test and contribute (so we can welcome external contributions too), and release checks</li>
<li>Links to pink paper, external resources of all kind (a dedicated page similar to github awesome-{x} repos.</li>
<li>Anything that's doesn't belong in the source code or is process related.</li>
</ul>
<h2 id="how-do-i-read-and-write-this-handbook"><a class="header" href="#how-do-i-read-and-write-this-handbook">How do I read and write this handbook?</a></h2>
<p>The book uses the simplest Markdown generator available, <code>mdbook</code> - intentionally.
No big features. It's simple. Any engineer should be able to learn and use it
in minutes - not hours.</p>
<ul>
<li><a href="https://rust-lang.github.io/mdBook/guide/reading.html">Reading the handbook</a></li>
<li><a href="https://rust-lang.github.io/mdBook/guide/creating.html">Contributing to the handbook</a></li>
</ul>
<p>Learn about it here: <a href="https://rust-lang.github.io/mdBook/index.html">mdbook</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="concepts"><a class="header" href="#concepts">Concepts</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="protocol-and-network"><a class="header" href="#protocol-and-network">Protocol and Network</a></h1>
<div style="break-before: page; page-break-before: always;"></div><p><img src="pinkpaper/files/pinkpaper-banner.svg" alt="DeFiChain Pink Paper" /></p>
<p>This is a working version of the Pink Paper for <a href="https://defichain.com">DeFiChain</a>.</p>
<p>Comments and pull requests are welcomed.</p>
<h2 id="goals"><a class="header" href="#goals">Goals</a></h2>
<ol>
<li>Lay out the roadmap for DeFiChain for the next few quarters, esp. 2021/2022.</li>
<li>To form the basis of an open discussion with DeFiChain community on the direction of the project.</li>
<li>Provide a general product and design direction for the engineering team.</li>
</ol>
<h2 id="sections"><a class="header" href="#sections">Sections</a></h2>
<table><thead><tr><th>#</th><th>Topic</th><th>Remarks</th></tr></thead><tbody>
<tr><td>1</td><td><a href="pinkpaper/README.html">Introduction</a></td><td>This document.</td></tr>
<tr><td>2</td><td><a href="pinkpaper//emission">Emission rate</a></td><td>Under implementation. Targeting May 2021 upgrade.</td></tr>
<tr><td>3</td><td><a href="pinkpaper//governance">Governance</a></td><td>Also community development fund management. <br> Under implementation. Targeting May 2021 upgrade.</td></tr>
<tr><td>4</td><td><a href="pinkpaper//price-oracle">Price oracle</a></td><td>Under implementation. Targeting May 2021 upgrade.</td></tr>
<tr><td>5</td><td><a href="pinkpaper//interchain-exchange">Interchain exchange (ICX)</a></td><td>Also Bitcoin atomic swap. Under implementation. Targeting May 2021 upgrade.</td></tr>
<tr><td>6</td><td><a href="pinkpaper//fees">Fees</a></td><td>Draft. Partial implementation.</td></tr>
<tr><td>7</td><td><a href="pinkpaper//futures">Futures</a></td><td>Early draft.</td></tr>
<tr><td>8</td><td><a href="pinkpaper//operator">Operator</a></td><td>Early draft.</td></tr>
<tr><td>9</td><td>Loan &amp; decentralized tokenization</td><td>Early draft.</td></tr>
<tr><td>10</td><td>Automated options</td><td>Early draft.</td></tr>
<tr><td>11</td><td>Non-Fungible Token (NFT)</td><td>Early draft.</td></tr>
</tbody></table>
<h4 id="see-also"><a class="header" href="#see-also">See also</a></h4>
<ul>
<li><a href="pinkpaper//files/2021-03-30%20DeFiChain%20PinkPaper%20Overview.pdf">Presentation deck on 2021-03-30</a></li>
</ul>
<h2 id="disclaimers"><a class="header" href="#disclaimers">Disclaimers</a></h2>
<ol>
<li>Content may be updated without notice.</li>
<li>Content does not guarantee implementation and does not imply implementation order.</li>
<li>Actual implementation may differ from the paper.</li>
<li>This my no means signify acceptance by the DeFiChain users and masternode owners.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dfi-emission-rate"><a class="header" href="#dfi-emission-rate">DFI emission rate</a></h1>
<h2 id="current"><a class="header" href="#current">Current</a></h2>
<p>From <a href="https://defichain.com/white-paper/#dfi-coin">white-paper</a>:</p>
<blockquote>
<p>DeFiChain is initially launched with a 200 DFI block reward, of which 10% goes to the community fund. The Foundation pledges to guarantee this 200 DFI block reward for at least 1,050,000 blocks since the the first genesis block, so approximately 1 year.</p>
</blockquote>
<p>The white paper lays out the expectation for the first year that the block reward is flat at 200 DFI. </p>
<p>2 DFIPs have since been made and implemented that affected the allocation of the 200 DFI, while the total emission remains consistent at 200 DFI.</p>
<ul>
<li><a href="https://github.com/DeFiCh/dfips/issues/1">DFIP #1: Bitcoin anchor reward source and mechanics adjustments</a> where 0.1 DFI is reduced from community fund to cater for anchor reward</li>
<li><a href="https://github.com/DeFiCh/dfips/issues/2">DFIP #2: DeFi incentive funding</a> where the original 180 DFI per block mining reward is reduced to 135 DFI </li>
</ul>
<p>To keep the total supply of DFI capped at 1.2 billion, the emission rate of DFI cannot stay consistent forever and will have to be reduced over time.</p>
<h2 id="foundation-and-community-fund"><a class="header" href="#foundation-and-community-fund">Foundation and Community Fund</a></h2>
<p>To further decentralize the governance of DeFiChain, the Foundation's role must be diminished significantly, and should not be holding any DFI. As such, it is proposed for the Foundation tokens to be burned entirely so no individuals or entities hold the private keys to the Foundation's DFI.</p>
<p>Community Fund today accumulates at 19.9 DFI per block and requires community funding proposal (CFP) to be made and votes to be called for the fund to be <em>manually</em> released. </p>
<p>Community Fund should be removed from address with private key to consensus-managed on-chain voting.</p>
<h2 id="emission-rate"><a class="header" href="#emission-rate">Emission rate</a></h2>
<h3 id="goals-1"><a class="header" href="#goals-1">Goals</a></h3>
<ol>
<li>Maintain the same emission rate on the first cycle.</li>
<li>Avoid the dramatic &quot;halving&quot; like Bitcoin's.</li>
<li>Maintain the 1.2 billion DFI cap.</li>
<li>Maintain a steady expected emission rate for foreseeable future.</li>
</ol>
<h3 id="current-rate"><a class="header" href="#current-rate">Current rate</a></h3>
<p>The current emission rate of DFI is 258.1 DFI per block – some of it are funded by airdrop fund.</p>
<table><thead><tr><th>Description</th><th>DFI per block</th></tr></thead><tbody>
<tr><td>Mining reward</td><td>135</td></tr>
<tr><td>Community fund</td><td>19.9</td></tr>
<tr><td>Anchor reward</td><td>0.1</td></tr>
<tr><td><em>DeFi incentives</em></td><td></td></tr>
<tr><td>BTC-DFI</td><td>80</td></tr>
<tr><td>ETH-DFI</td><td>15</td></tr>
<tr><td>USDT-DFI</td><td>5</td></tr>
<tr><td>LTC-DFI</td><td>2</td></tr>
<tr><td>BCH-DFI</td><td>1</td></tr>
<tr><td>DOGE-DFI</td><td>0.1</td></tr>
<tr><td><strong>TOTAL</strong></td><td>258.1</td></tr>
</tbody></table>
<p>The same rate will be retained on the first cycle. </p>
<p>On top of the above, the following will also be pre-allocated on the first cycle:</p>
<table><thead><tr><th>Description</th><th>In use today?</th><th>DFI per block</th><th>Proportion</th></tr></thead><tbody>
<tr><td>Mining reward</td><td>Yes</td><td>135</td><td>33.33% (guaranteed)</td></tr>
<tr><td>Community fund</td><td>Yes</td><td>19.9</td><td>4.91%</td></tr>
<tr><td>Anchor reward</td><td>Yes</td><td>0.1</td><td>0.02%</td></tr>
<tr><td>DEX liquidity mining</td><td>Yes</td><td>103.1</td><td>25.45%</td></tr>
<tr><td>Atomic swap incentives</td><td>No</td><td>50</td><td>12.34%</td></tr>
<tr><td>Futures incentives</td><td>No</td><td>50</td><td>12.34%</td></tr>
<tr><td>Options incentives</td><td>No</td><td>40</td><td>9.88%</td></tr>
<tr><td>Unallocated incentives</td><td>No</td><td>6.94</td><td>1.71%</td></tr>
<tr><td><strong>TOTAL</strong></td><td></td><td>405.04</td><td>100%</td></tr>
</tbody></table>
<h3 id="cycle--reduction"><a class="header" href="#cycle--reduction">Cycle &amp; Reduction</a></h3>
<p>Emission rate will start at 405.04 DFI on the first cycle so that it flows smoothly with no change before the implementation. The increment on the first cycle is coming from the <a href="https://github.com/DeFiCh/dfips/issues/17">destruction of Foundation-owned DFI</a>.</p>
<p>Cycle period is 32,690 blocks, at 37 seconds per block, each cycle takes approximately 2 weeks. </p>
<p>Every cycle, the block reward reduces by 1.658%. The splitting of the rewards for respective incentives will be maintained at the same proportion as laid out on the schedule above.</p>
<p>Unused reward will be burned. Burned rewards will not be re-introduced, therefore counted towards the 1.2 billion supply cap.</p>
<p>Rewards proposed may be adjusted with future on-chain governance changes, however, masternode (mining) rewards are guaranteed to be 33.33% of the total block reward.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fees-on-defichain"><a class="header" href="#fees-on-defichain">Fees on DeFiChain</a></h1>
<p>Usage of DeFiChain generally consists of the following fees:</p>
<ol>
<li>Miner fee</li>
<li>Operator fee</li>
<li>DeFi fee</li>
</ol>
<h2 id="miner-fee"><a class="header" href="#miner-fee">Miner fee</a></h2>
<p>Miner fee is the small fee, paid in UTXO DFI, to masternodes (also referred to as miners) for transaction validation and inclusion in a block.</p>
<p>This works the same as Bitcoin blockchain, measured in data size, e.g. price per byte.</p>
<h2 id="operator-fee"><a class="header" href="#operator-fee">Operator fee</a></h2>
<p>As part of DeFiChain generalization, many services will soon be run by <a href="pinkpaper/fees/../operator">operators</a>.</p>
<p>For providing of services and applications on DeFiChain, operators are able to determine fees for the services that they would charge freely. Fees can be in any form of tokens, DFI or operators' own tokens, or a combination of multiple tokens. What an operator chooses to do with the operator fee is at the operator's discretion.</p>
<h2 id="defi-fee"><a class="header" href="#defi-fee">DeFi fee</a></h2>
<p>DeFi fee is charged for all DeFi transactions on DeFiChain regardless of operators.</p>
<h3 id="fee-schedule"><a class="header" href="#fee-schedule">Fee schedule</a></h3>
<p>All fees are burned in a trackable and transparent manner.</p>
<p>The following fees are for illustrative purposes only and have yet to be fully determined.</p>
<table><thead><tr><th>Operations</th><th style="text-align: right">Burn amount (in DFI)</th></tr></thead><tbody>
<tr><td><strong>Masternode</strong></td><td style="text-align: right"></td></tr>
<tr><td>Registration</td><td style="text-align: right">10</td></tr>
<tr><td><strong>Operator</strong></td><td style="text-align: right"></td></tr>
<tr><td>Registration</td><td style="text-align: right">1000</td></tr>
<tr><td><strong>Tokenization</strong></td><td style="text-align: right"></td></tr>
<tr><td>Create a new token</td><td style="text-align: right">100</td></tr>
<tr><td><strong>Liquidity pool</strong></td><td style="text-align: right"></td></tr>
<tr><td>Create pool</td><td style="text-align: right">300</td></tr>
<tr><td>Swap (for non-DFI pairs)</td><td style="text-align: right">0.01</td></tr>
<tr><td><strong>Governance</strong></td><td style="text-align: right"></td></tr>
<tr><td>Initiate community fund request</td><td style="text-align: right">5</td></tr>
<tr><td>Initiate vote of confidence</td><td style="text-align: right">25</td></tr>
<tr><td>Initiate block reward reallocation proposal</td><td style="text-align: right">250</td></tr>
<tr><td><strong>Interchain exchange</strong></td><td style="text-align: right"></td></tr>
<tr><td>Atomic swap</td><td style="text-align: right">0.01</td></tr>
<tr><td><strong>Oracle</strong></td><td style="text-align: right"></td></tr>
<tr><td>Create price feed</td><td style="text-align: right">100</td></tr>
<tr><td>Appoint oracle</td><td style="text-align: right">20</td></tr>
<tr><td><strong>Loan</strong></td><td style="text-align: right"></td></tr>
<tr><td>Loan interest</td><td style="text-align: right">TBD</td></tr>
<tr><td>Liquidation fee</td><td style="text-align: right">TBD</td></tr>
<tr><td><strong>Option pool</strong></td><td style="text-align: right"></td></tr>
<tr><td>Create pool</td><td style="text-align: right">300</td></tr>
<tr><td>Option contract creation</td><td style="text-align: right">0.01</td></tr>
<tr><td>Bonus payout fee</td><td style="text-align: right">TBD</td></tr>
<tr><td><strong>Future</strong></td><td style="text-align: right"></td></tr>
<tr><td>Create future market</td><td style="text-align: right">300</td></tr>
<tr><td>Trade fee</td><td style="text-align: right">TBD</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="futures"><a class="header" href="#futures">Futures</a></h1>
<p>Stocks, commodities and real-world tokenization will be offered on DeFiChain via futures contract, offered by <a href="pinkpaper/futures//operator">Operators</a>.</p>
<p>Future is offered by operators with the assistance of price oracles, allowing prices of assets to be tracked, real world or otherwise.</p>
<p>DeFiChain will support 2 types of futures:</p>
<ol>
<li>Fixed expiry</li>
</ol>
<ul>
<li>With a fixed expiry at a certain date in the future.</li>
<li>At the time of expiry,</li>
</ul>
<ol start="2">
<li>Perpetual swap</li>
</ol>
<ul>
<li>With funding mechanics</li>
</ul>
<h2 id="mechanics"><a class="header" href="#mechanics">Mechanics</a></h2>
<ol>
<li>Margin contract</li>
</ol>
<ul>
<li>Trader is able to fund their Future trading position through this margin contract.</li>
<li>Contract can be funded with DFI and other tokens that operators decide, e.g. BTC.</li>
<li>Operator can also define <em>initial margin</em> and <em>maintenance margin</em> for a margin contract.</li>
</ul>
<ol start="2">
<li>Asset</li>
</ol>
<ul>
<li>Operator decide assets to list.</li>
<li>Assets can be stocks, commodities or anything that has a price. It is operator's responsibility to ensure that there are good price oracles for traded assets.</li>
</ul>
<ol start="3">
<li>Order</li>
</ol>
<ul>
<li>User is able to make an order. It can be a <strong>long</strong> or <strong>short</strong> order.</li>
<li>Orders are matched automatically on-chain.</li>
</ul>
<ol start="4">
<li>Settlement</li>
</ol>
<ul>
<li>Fixed expiry future will be settled automatically based on settlement oracle price published.</li>
<li>Perpetual swap future has no settlement. There is instead a <strong>funding rate mechanism</strong>.</li>
</ul>
<ol start="5">
<li>Perpetual swap funding</li>
</ol>
<ul>
<li>Funding rate is automatically determined by DeFiChain based on fixed algorithm: oracle price, perpetual swap trading price.</li>
<li>Funding period can be set by operator, but it should be between 1x to a max of 12x per day. For reference, most centralized perpetual swap offerings have a 8h funding interval (3x per day).</li>
</ul>
<ol start="6">
<li>Liquidation</li>
</ol>
<ul>
<li>When net margin (total margin + unrealized PnL) is less than maintenance margin, forced liquidation would occur.</li>
<li>TBD: Either automated, operator-run, or community-run with incentives.</li>
</ul>
<h3 id="enahncements"><a class="header" href="#enahncements">Enahncements</a></h3>
<ol>
<li>Future can further be enhanced to allow leverage. DeFiChain will start with no leverage (1x) and will introduce leverage once the mechanisms are stable.</li>
</ol>
<h2 id="rpc"><a class="header" href="#rpc">RPC</a></h2>
<p><em>TK</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="on-chain-governance"><a class="header" href="#on-chain-governance">On-chain Governance</a></h1>
<h2 id="governance-summary"><a class="header" href="#governance-summary">Governance summary</a></h2>
<p>Voting is carried out every 130,000 blocks, roughly once every calendar month.</p>
<p>Types of governance:</p>
<ol>
<li>
<p>Community development fund request proposal</p>
<ul>
<li>Requesting of community development fund.</li>
<li>Requires simple majority (&gt; 50%) by non-neutral voting masternodes to pass.</li>
<li>Fee: 10 DFI per proposal</li>
</ul>
</li>
<li>
<p>Block reward reallocation proposal</p>
<ul>
<li>Note the miner's reward (PoS) are guaranteed and cannot be reallocated.</li>
<li>Requires super majority (&gt; 66.67%) by non-neutral voting masternodes to pass.</li>
<li>Fee: 500 DFI per proposal</li>
</ul>
</li>
<li>
<p>Vote of confidence</p>
<ul>
<li>General directional vote, not consensus enforceable.</li>
<li>Requires super majority (&gt; 66.67%) by non-neutral voting masternodes to pass.</li>
<li>Fee: 50 DFI per proposal</li>
</ul>
</li>
</ol>
<p>All fees are trackably burned.</p>
<h2 id="community-fund-request-proposal-cfp"><a class="header" href="#community-fund-request-proposal-cfp">Community fund request proposal (CFP)</a></h2>
<h3 id="current-1"><a class="header" href="#current-1">Current</a></h3>
<p>Currently every block creates 19.9 DFI to community fund address that is controlled by Foundation.</p>
<h3 id="improvements"><a class="header" href="#improvements">Improvements</a></h3>
<p>The amount at <code>dZcHjYhKtEM88TtZLjp314H2xZjkztXtRc</code> will be moved to a community balance, we call this the &quot;Community Development Fund&quot;.</p>
<p>This fund, will be similar to Incentive Funding and Anchor Reward, they have no private keys and are unrealized by default unless allocated.</p>
<p>Voting is carried our every 90,000 blocks (roughly once every calendar month). This should be configurable as chainparams and requires a hardfork to update. The block where the vote is finalized is also known as &quot;Voting Finalizing Block&quot;.</p>
<p>User is able to submit a fund request that is to be voted by masternodes. Each fund request costs non-refundable 10 DFI. The 10 DFI is not burned, but being added to the proposal for that will be paid out to all voting masternodes to encourage participation. Each fund request can be also specify <code>cycle</code>. Cycle is defaulted to <code>1</code> for one-off fund request, this also allows for periodic fund requests where a request is for a fixed amount to be paid out every cycle (every 90,000 blocks) for the specified cycles if the funding request remains APPROVED state.</p>
<h3 id="data-structure-of-a-funding-request"><a class="header" href="#data-structure-of-a-funding-request">Data structure of a funding request</a></h3>
<h4 id="user-submitted-data"><a class="header" href="#user-submitted-data">User submitted data</a></h4>
<ol>
<li>Title (required, this may also be implemented as hash of title to conserve on-chain storage)</li>
<li>Payout address (required) this can be different from requester's address</li>
<li>Finalize after block (optional, default=curr block + (blocks per cycle / 2))
<ul>
<li>Max valid value would be curr block + 3 * blocks per cycle. No minimum.</li>
<li>The rationale for this value is to allow sufficient time for requests to be discussed and voted on, esp. when it is submitted closer to the end of current voting cycle.</li>
</ul>
</li>
<li>Amount per period (in DFI)</li>
<li>Period requested (required, integer, default=1)</li>
</ol>
<h4 id="internal-data"><a class="header" href="#internal-data">Internal data</a></h4>
<ol>
<li>Completed payment periods (integer)</li>
<li>State</li>
<li>Voting data</li>
</ol>
<h4 id="states-of-funding-request"><a class="header" href="#states-of-funding-request">States of funding request</a></h4>
<p>Funding requests can have one of the following states</p>
<ol>
<li><code>VOTING</code>: Successfully submitted request, currently undergoing voting state</li>
<li><code>REJECTED</code>: At voting finalizing block, if a request does not achieve. This is a FINAL state and cannot be re-opened.</li>
<li><code>COMPLETED</code>: A funding request that has been paid out entirely. When completed payment periods is equals to period requested, request is marked as <code>COMPLETED</code>. . This is a FINAL state and cannot be re-opened.</li>
</ol>
<p>The absence of the state <code>APPROVED</code> is intended. An approved request will simply have its payout made and increment the completed payment period. If payment has been completed fully, request state will be changed to <code>COMPLETED</code>, which is a final state. A corollary to this allows for a request that requested for a payout of 1000 DFI every month and has received for 2 months to be rejected at the 3rd month if there are more no votes to yes votes.</p>
<h3 id="rpc-1"><a class="header" href="#rpc-1">RPC</a></h3>
<ol>
<li>
<p><code>creategovcfr '{DATA}'</code></p>
<ul>
<li><code>DATA</code> is serialized JSON with the following:
<ul>
<li><code>title</code></li>
<li><code>finalizeAfter</code>: Defaulted to current block height + 90000/2. All eligible proposals have to be submitted at least 90k blocks before the finalizing block and not more than 270k blocks before.</li>
<li><code>cycles</code>: Defaulted to <code>1</code> if unspecified.</li>
<li><code>amount</code>: in DFI.</li>
<li><code>payoutAddress</code>: DFI address</li>
</ul>
</li>
<li>10 DFI is paid along with the submission.</li>
<li>Request is finalized after submission, no edits are possible thereafter.</li>
<li>Returns <code>txid</code>. The <code>txid</code> is also used as the proposal ID.</li>
</ul>
</li>
<li>
<p><code>vote PROPOSALID DECISION</code></p>
<ul>
<li><code>PROPOSALID</code> is the <code>txid</code> of the submitted funding request.</li>
<li><code>DECISION</code> can be either of the following:
<ul>
<li><code>yes</code></li>
<li><code>no</code></li>
<li><code>neutral</code></li>
</ul>
</li>
<li>A masternode is able to change the vote decisions before the request is finalized, the last vote as seen on the block BEFORE finalizing block is counted.</li>
</ul>
</li>
</ol>
<h2 id="votes"><a class="header" href="#votes">Votes</a></h2>
<p>A masternode is deemed to be eligible to cast a vote if ALL the following conditions are satisfied:</p>
<ol>
<li>The masternode is in <code>ENABLED</code> state during vote submission AND at vote finalizing block.</li>
<li>The masternode has successfully minted at least 1 block during vote submission AND at vote finalizing block.</li>
</ol>
<p>Any eligible masternodes can cast a vote to any proposal that is in <code>VOTING</code> state, regardless of completed payment period.</p>
<p>Masternodes are able to cast any of the following votes:</p>
<ol>
<li>YES</li>
<li>NO</li>
<li>NEUTRAL</li>
</ol>
<p>At every vote finalizing block, a community fund proposal (CFP) is deemed to be eligible to be paid out of all the followings are true:</p>
<ol>
<li>There are more YES votes than NO votes. Simple majority wins. NEUTRAL votes are not counted. If there are equal amount of YES and NO votes, the CFR is deemed to have failed and rejected.</li>
<li>The voting masternodes eligibility must be <code>ENABLED</code> at the finalizing block and have mined at least 1 block.</li>
<li>Quorum: All proposals require at least 1% of voting masternodes of all active masternodes that mined at least 1 block before the finalizing block.</li>
</ol>
<h2 id="other-proposals"><a class="header" href="#other-proposals">Other proposals</a></h2>
<p>Other proposals such as block reallocation proposal and vote of confidence will follow the same voting cycle.</p>
<h2 id="supplementary-website"><a class="header" href="#supplementary-website">Supplementary website</a></h2>
<p>While blockchain's as data storage is desired to maintain impartiality and anonymity of discussions, it is not a conducive medium for a wider discussion. A supplementary website will be made available to facilitate all proposal discussions and track the progress.</p>
<p>A good supplementary website is suggested to carry the following features:</p>
<ol>
<li><strong>Proposer identification</strong> to facilitate meaningful discussion among the community and the proposer. This does not, however, imply the need of a user account system.</li>
<li><strong>Proposal extension and title hash validation</strong>. As the blockchain only contains the hash of title, the supplementary website must allow the proposer to enter the full proposal title hash and enter any additional descriptions on the proposals.</li>
<li><strong>Vote tracking</strong>. Ability to track votes as it happens.</li>
</ol>
<p>An example good supplementary website would be https://www.dashcentral.org/budget for Dash.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="interchain-exchange"><a class="header" href="#interchain-exchange">Interchain Exchange</a></h1>
<h2 id="goals-2"><a class="header" href="#goals-2">Goals</a></h2>
<p>Allow users to trustlessly and seamlessly swap between DST and Bitcoin BTC. BTC in the rest of this document will only referring to BTC on Bitcoin blockchain and not BTC DST.</p>
<p>Key areas of focus, in decreasing order of importance:</p>
<ol>
<li>Safety</li>
<li>User experience – it should be easily presentable on a client UI</li>
<li>Seamlessness - most of the steps should be automated at client</li>
</ol>
<h2 id="components"><a class="header" href="#components">Components</a></h2>
<ol>
<li>
<p>Hash Time Lock Contract</p>
<ul>
<li>A.k.a. HTLC</li>
<li>Part of Bitcoin script, and DFC side, it's a new construct for DST.</li>
<li>Requires both participants to be active.</li>
<li>H = Hash(S)</li>
</ul>
</li>
<li>
<p>Inter-chain Exchange</p>
<ul>
<li>A.k.a. ICX / XCX</li>
<li>This is on-chain (DeFiChain) trustless exchange with &quot;traditional&quot; orderbook</li>
</ul>
</li>
<li>
<p>SPV wallet</p>
<ul>
<li>Simple Payment Verification Bitcoin wallet</li>
<li>Distributed as part of DeFiChain node</li>
<li>This is why we are only supporting Bitcoin, at least for now.</li>
</ul>
</li>
</ol>
<h2 id="glossary"><a class="header" href="#glossary">Glossary</a></h2>
<ol>
<li>Buyer vs Seller</li>
<li>Maker vs Taker</li>
</ol>
<h2 id="scenarios"><a class="header" href="#scenarios">Scenarios</a></h2>
<p>2 scenarios:</p>
<ol>
<li>
<p>DST seller maker, wants BTC</p>
<ul>
<li>Paired with BTC seller taker</li>
</ul>
</li>
<li>
<p>BTC seller maker, wants DST</p>
<ul>
<li>Paired with DST seller taker</li>
</ul>
</li>
</ol>
<h2 id="scenario-1"><a class="header" href="#scenario-1">Scenario 1</a></h2>
<p><img src="pinkpaper/interchain-exchange/img/xcx-scenario1.png" alt="Scenario 1" /></p>
<p>Alice
- Sells DST, wants BTC
- Maker</p>
<p>Bob
- Sells BTC, wants DST
- Taker</p>
<ol>
<li>
<p>Alice, as maker, puts up an order:</p>
<ul>
<li>For sale: 10 TSLA DST</li>
<li>unitPrice: 0.02 <em>(BTC - $800 each for BTC at $40k)</em></li>
<li>expiry: 2880 blocks</li>
<li>optionFeePerUnit: 8 <em>(DFI)</em></li>
</ul>
</li>
<li>
<p>Bob, as taker:</p>
<ul>
<li>Wants to buy just 2.5 TSLA, not all 10. <em>(partial order)</em></li>
<li>Makes an acceptance offer.</li>
<li>Transmits <code>optionFeePerUnit * unit</code> 8 * 2.5 = 20 DFI alongside the order into HTLC. No payment DFI is locked up yet, only 20 DFI for optionFee</li>
<li>UX: either browse orderbook, or do a market order <em>(easier: always match with the best price)</em></li>
</ul>
</li>
<li>
<p>Alice accepts the offer</p>
<ul>
<li>UX side this is automatically accepted</li>
<li>Moves 2.5 TSLA from the order into DFC DST HTLC (also known as ICX Contract).</li>
<li>Properties of HTLC:
<ul>
<li>2.5 TSLA locked up for 120 blocks (1 hour)</li>
<li>with H provided, where H = Hash(S) the funds for Bob can be unlocked from this HTLC.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Bob sees the DST HTLC, verifies the following:</p>
<ul>
<li>Amount, token, time locked up and recipient is correct.</li>
<li>Waits for sufficient confirmation at DFC side to ensure finality.</li>
<li>Bob, now initiates on the Bitcoin side, HTLC for:
<ul>
<li>2.5 * 0.02 = 0.05 BTC</li>
<li>With the same H. Take note that Alice knows S, but Bob does not know S.</li>
<li>Time limit is 30 minutes.</li>
</ul>
</li>
<li>Bob updates ICX C on this HTLC.</li>
</ul>
</li>
<li>
<p>Alice accepting Bitcoin</p>
<ul>
<li>Alice confirms that HTLC properties are correct, amount, time, recipient.</li>
<li>Waits for sufficient confirmation at Bitcoin blockchain to ensure finality.</li>
<li>Claims Bitcoin by revealing S.</li>
</ul>
</li>
<li>
<p>Bob now claims DST.</p>
<ul>
<li>Bob sees that Alice has claimed and revealed S.</li>
<li>Bob claims DST too by using the same S.</li>
<li>DST is claimed on ICX C itself, this sends DST to Bob, and refunds Bob the <code>optionFee</code>.</li>
</ul>
</li>
</ol>
<h3 id="bad-actors"><a class="header" href="#bad-actors">Bad actors</a></h3>
<ol>
<li>N/A</li>
<li>N/A</li>
<li>If Alice does not accept, Bob's offer expires after 20 blocks and takes back <code>optionFee</code>.</li>
<li>If Bob does not honor the BTC side, Alice receives back her 2.5 TSLA after 1 hour + <code>optionFee</code>.</li>
</ol>
<h2 id="scenario-2"><a class="header" href="#scenario-2">Scenario 2</a></h2>
<p><img src="pinkpaper/interchain-exchange/img/xcx-scenario2.png" alt="Scenario 2" /></p>
<p>Charlie
- Sells BTC, wants DST
- Maker</p>
<p>Dave
- Sells DST, wants BTC
- Taker</p>
<ol>
<li>
<p>Charlie, as maker, puts up an order:</p>
<ul>
<li>Buying: 10 TSLA DST</li>
<li>unitPrice: 0.02 <em>(BTC - $800 each for BTC at $40k)</em></li>
<li>expiry: 2880 blocks</li>
<li>optionFeePerUnit: 8 <em>(DFI)</em></li>
</ul>
</li>
<li>
<p>Dave, as taker:</p>
<ul>
<li>Wants to sell just 2.5 TSLA, not all 10. <em>(partial order)</em></li>
<li>Makes an acceptance offer.</li>
<li>Transmits <code>optionFeePerUnit * unit</code> 8 * 2.5 = 20 DFI alongside the order into HTLC. No payment DFI is locked up yet, only 20 optionFee DFI.</li>
<li>UX: either browse orderbook, or do a market order <em>(easier: always match with the best price)</em></li>
</ul>
</li>
<li>
<p>Charlie accepts the offer</p>
<ul>
<li>Charlie comes up with S. Computes H where H = Hash(S).</li>
<li>Charlie locks up BTC on the Bitcoin HTLC for:
<ul>
<li>2.5 * 0.02 = 0.05 BTC</li>
<li>With H. Take note that Charlie knows S, but Dave does not know S.</li>
<li>Time limit is 1 hour (6 blocks).</li>
</ul>
</li>
<li>and creates ICX Contract with H, and Bitcoin HTLC address.</li>
<li>Dave's <code>optionFee</code> is locked in ICX C.</li>
</ul>
</li>
<li>
<p>Dave sees that Charlie has accepted the offer and that BTC is now locked in HTLC</p>
<ul>
<li>Validates that BTC HTLS is correctly set up - amount, time, recipient</li>
<li>Waits for sufficient confirmation on BTC side to ensure finality.</li>
<li>Moves 2.5 TSLA from the order into DFC ICX C (no need to provide H as contract already know H)</li>
</ul>
</li>
<li>
<p>Charlie accepts DST</p>
<ul>
<li>Waits for sufficient confirmation on DFC side to ensure finality.</li>
<li>Claims DST by revealing S</li>
<li>This sends DST to Charlie and refunds <code>optionFee</code> to Dave.</li>
</ul>
</li>
<li>
<p>Dave now claims BTC</p>
<ul>
<li>using the same S on the BTC HTLC</li>
</ul>
</li>
</ol>
<h3 id="bad-actors-1"><a class="header" href="#bad-actors-1">Bad actors</a></h3>
<ol>
<li>N/A</li>
<li>N/A</li>
<li>If Charlie does not accept, Bob's offer expires after 10 blocks and takes back <code>optionFee</code>.</li>
<li>If Bob does not honor the BTC side, Alice receives back her 2.5 TSLA after 1 hour + <code>optionFee</code>.</li>
</ol>
<h1 id="override-notice-fees-and-incentives"><a class="header" href="#override-notice-fees-and-incentives">Override Notice: Fees and Incentives</a></h1>
<p><em>TODO: Cleanup this document to be coherent</em></p>
<p>The above document has parts overriden by the <a href="pinkpaper/interchain-exchange/fees.html">fees document</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="interchain-exchange-fees"><a class="header" href="#interchain-exchange-fees">Interchain Exchange fees</a></h1>
<h2 id="game-theory-exploits"><a class="header" href="#game-theory-exploits">Game theory exploits</a></h2>
<p>The following fees are suggested to prevent the following:</p>
<ol>
<li>Users could potentially take up their own orders to generate fake transactions.</li>
<li>Users could potentially take up other users' orders to eliminate competition and increase own incentives returns.</li>
<li>Users could leave their orders passively and not respond to take requests.</li>
</ol>
<h2 id="general-ideas"><a class="header" href="#general-ideas">General ideas</a></h2>
<ul>
<li>Negative maker fee</li>
<li>Positive taker fee</li>
<li>Also the DFI made by Maker, inclusive of bonus must be less than fees paid by Taker. Without it fake transactions would be generated to game rewards.</li>
</ul>
<h2 id="fees"><a class="header" href="#fees">Fees</a></h2>
<ul>
<li>Previous <code>optionFee</code> is now replaced with non-refundable <code>takerFee</code>.
<ul>
<li>This is to deal the case where Alice refuses to accept Bob's valid HTLC <em>(Scenario 1)</em> and unfairly profits from <code>optionFee</code>.</li>
</ul>
</li>
<li><code>takerFee</code> is in DFI and is fixed at consensus-set (<code>takerFeePerBTC</code> * BTC * <code>DEX DFI per BTC rate</code>).</li>
<li><code>makerDeposit</code> being the same as <code>takerFee</code>.
<ul>
<li>It is refundable upon successful swap.</li>
</ul>
</li>
<li><code>makerIncentive</code>
<ul>
<li><code>25% * takerFee</code></li>
</ul>
</li>
<li><code>makerBonus</code>
<ul>
<li><code>50% * takerFee</code> if it's BTC parity trade. BTC DSTs eligible for <code>makerBonus</code> are consensus-set.</li>
</ul>
</li>
</ul>
<h3 id="dst-maker-exiting-to-bitcoin"><a class="header" href="#dst-maker-exiting-to-bitcoin">DST maker exiting to Bitcoin</a></h3>
<ol>
<li>Maker, pays no fee, but locks up DST <em>(consensus-verifiable)</em>.</li>
<li>Taker makes offer, locks up <code>takerFee</code>.
<ul>
<li>If offer is not accepted after timeout, <code>takerFee</code> is refunded.</li>
</ul>
</li>
<li>Maker accepts offer, locks up DST <em>(consensus-verifiable)</em>, burns <code>makerDeposit</code> &amp; <code>takerFee</code>.
<ul>
<li>If partial amount from offer is accepted, refunds unused <code>takerFee</code> proportionally back to Taker.</li>
</ul>
</li>
<li>Taker locks up BTC <em>(non-consensus-verifiable)</em> and updates ICXC on BTC HTLC.</li>
<li>Maker verifies that BTC HTLC is correct, claims BTC.
<ul>
<li>If Taker locks up incorrectly, both parties lose DFI <em>(neither party wins)</em></li>
<li>If Maker does not verify, both parties lose DFI <em>(neither party wins)</em></li>
</ul>
</li>
<li>Taker claims DST on ICXC.
<ul>
<li>Mints <code>makerDeposit</code> <em>(refund)</em>, <code>makerIncentive</code> &amp; <code>makerBonus</code> <em>(if any)</em> to Maker.</li>
<li>Validate that the amounts are correct – no additional tokens are generated.</li>
</ul>
</li>
</ol>
<h3 id="btc-maker-entering-from-bitcoin"><a class="header" href="#btc-maker-entering-from-bitcoin">BTC maker entering from Bitcoin</a></h3>
<ol>
<li>Maker, pays no fee.</li>
<li>Taker makes offer, locks up <code>takerFee</code>.
<ul>
<li>If offer is not accepted after timeout, <code>takerFee</code> is refunded.</li>
</ul>
</li>
<li>Maker accepts offer, locks up <code>makerDeposit</code>.</li>
<li>Taker locks up DST <em>(consensus-verifiable)</em>, burns both <code>takerFee</code> and <code>makerDeposit</code>.
<ul>
<li>If Taker does not do it, burns <code>takerFee</code> and refund <code>makerDeposit</code> to Maker.</li>
</ul>
</li>
<li>Maker locks up BTC <em>(non-consensus-verifiable)</em> and updates ICXC on BTC HTLC.</li>
<li>Taker verifies that BTC HTLC is correct, claims BTC.
<ul>
<li>If Maker locks up incorrectly, both parties lose DFI <em>(neither party wins)</em></li>
<li>If Taker does not verify, both parties lose DFI <em>(neither party wins)</em></li>
</ul>
</li>
<li>Maker claims DST on ICXC
<ul>
<li>Mints <code>makerDeposit</code> <em>(refund)</em>, <code>makerIncentive</code> &amp; <code>makerBonus</code> <em>(if any)</em> to Maker.</li>
<li>Validate that the amounts are correct – no additional tokens are generated.</li>
</ul>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="loan-and-decentralized-tokenization"><a class="header" href="#loan-and-decentralized-tokenization">Loan and Decentralized Tokenization</a></h1>
<p>Loan is be offered by <a href="pinkpaper/loan/../operator">operator</a> to allow decentralized price-tracking tokens to be created by users.</p>
<p>Before Operator model is ready, it uses only 1 default <a href="pinkpaper/loan/../operator">opspace</a> and requires foundation authorization, that acts on behalf of community.</p>
<p>Possibility of tokens being offered in a decentralized manner can be of many types, including but not limited to:</p>
<ol>
<li>Cryptocurrency such as <code>BTC</code>, <code>ETH</code>, <code>LTC</code>, etc.</li>
<li>Stablecoin such as <code>USD</code>, <code>EUR</code> tokens, etc.</li>
<li>Stocks token such as <code>TSLA</code>, <code>MSFT</code>, etc.</li>
<li>Other asset tokens.</li>
</ol>
<h2 id="concepts-1"><a class="header" href="#concepts-1">Concepts</a></h2>
<h3 id="collateralization-ratio"><a class="header" href="#collateralization-ratio">Collateralization ratio</a></h3>
<p>Loan on DeFiChain operates on over-collateralization mechanism. User first has to open a vault to mint tokens.</p>
<p>Collateralization is calculated for each vaults, using the following formula:</p>
<pre><code>Collateralization ratio =
    Total effective value of collateral /
    (Total value of tokens minted + Total interest)
</code></pre>
<p>For example, if a vault holds $200 worth of collateral asset, with $90 minted tokens and $10 of total interest accrued, the collateralization ratio is 200 / (90 + 10) = 2.</p>
<p>This is not to be confused with <em>collateralization factor</em>.</p>
<h3 id="collateralization-factor"><a class="header" href="#collateralization-factor">Collateralization factor</a></h3>
<p>Assets that are accepted for collateralization could be accepted at different collateralization factor, from 0% to 100%. When an asset collateralization factor is 100%, the entirety of the asset's value contributes to the collateralization value of the vault, however, if an asset collateralization factor is say 50%, then only half of its value contributes to the total vault's collateral.</p>
<p>For example if <code>DOGE</code> is accepted at 70% collateralization factor, $100 of <code>DOGE</code> would contribute to $70 of collateral value in a vault.</p>
<p>This is not to be confused with <em>collateralization ratio</em>.</p>
<h3 id="operator"><a class="header" href="#operator">Operator</a></h3>
<p>Operator plays to role to decide on the following:</p>
<ol>
<li>Collateral tokens and their respective collateralization values.
<ul>
<li>For instance, an Operator can decide to allow users to start a Vault in their opspace with the following collateralization factors:
<ul>
<li><code>DFI</code> at 100% collateralization factor</li>
<li><code>BTC</code> at 100% collateralization factor</li>
<li><code>DOGE</code> at 70% collateralization factor</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>Operator, also via opspace's governance values, can decide the following:</p>
<ul>
<li><code>LOAN_LIQUIDATION_PENALTY</code>: 0.05 (default), for 5% liquidation penalty. This is converted into DFI upon liquidation and burned.</li>
</ul>
<h3 id="loan-scheme"><a class="header" href="#loan-scheme">Loan scheme</a></h3>
<p>Loan scheme allows an operator to set up different loan schemes under the same Operator. Loan schemes allows an operator to define the following:</p>
<ul>
<li>Collateral token and different collateralization factor</li>
<li>Loan interest rates</li>
</ul>
<p>For example, a series of loan schemes could be made available:</p>
<ol>
<li>Min collateralization ratio: 150%. Interest rate: 5% APR.</li>
<li>Min collateralization ratio: 175%. Interest rate: 3% APR.</li>
<li>Min collateralization ratio: 200%. Interest rate: 2% APR.</li>
<li>Min collateralization ratio: 350%. Interest rate: 1.5% APR.</li>
<li>Min collateralization ratio: 500%. Interest rate: 1% APR.</li>
<li>Min collateralization ratio: 1000%. Interest rate: 0.5% APR.</li>
</ol>
<p>Vault owner can define which loan scheme to subscribe to during initial vault creation and can move it freely after that. Take caution though that if you move to a scheme with lower collateralization ratio, liquidation might be triggered.</p>
<h3 id="interest-rate"><a class="header" href="#interest-rate">Interest rate</a></h3>
<p>Interest rate for loan consists of 2 parts:</p>
<ul>
<li>Vault interest, based on loan scheme of individual vaults</li>
<li>Token interest, based on loan tokens, e.g. <code>TSLA</code> token might have its own interest that is chargeable only for <code>TSLA</code> token.</li>
</ul>
<p><a href="pinkpaper/loan/../fees">DeFi fees</a> are burned. Fees are typically collected in the form of the loan token repayment, and automatically swapped on DEX for DFI to be burned.</p>
<p>For example, if a loan of 100 <code>TSLA</code> is taken out and repaid back exactly 6 months later with the APR of 2%, the user will have to repay 101 <code>TSLA</code> during redemption to regain full access of collateral in the vault.</p>
<p>100 <code>TSLA</code> will be burned as part of the repayment process. 1 <code>TSLA</code> that forms the interest payment will be swapped on DEX for DFI. The resulting DFI will burned. All of these occur atomically as part of DeFiChain consensus.</p>
<h3 id="vault"><a class="header" href="#vault">Vault</a></h3>
<p>User is able to freely open a vault and deposit tokens to a vault. Vault is transferable to other owners, including being controlled by multisig address.</p>
<h3 id="collateral-dfi-requirement"><a class="header" href="#collateral-dfi-requirement">Collateral DFI requirement</a></h3>
<p>Vault's collateral requires at least 50% of it to be DFI.</p>
<p>When depositing non-DFI collateral to a vault, it needs to ensure that the resulting DFI proportion of for vault's collateral is at least 50% or more, or the deposit transaction should fail.</p>
<p>This requirement is only checked upon deposited and does not play a role in liquidation. For instance, if at the time of posit, a vault's DFI collateral is 52%, but falls to 49% without any further deposit. This WILL NOT trigger liquidation as long as vault's minimum collateralization ratio condition is still met.</p>
<h3 id="states"><a class="header" href="#states">States</a></h3>
<ul>
<li>&quot;active&quot; : Vault is above its collateralization ratio and both collaterals and loans price feeds are valid.</li>
<li>&quot;frozen&quot; : Any of collateral or loan price feed is invalid. No action can be undertaken while vault is frozen.</li>
<li>&quot;inLiquidation&quot; : Vault is under liquidation and has undergoing auctions.</li>
<li>&quot;mayLiquidate&quot; : Vault will liquidate at the next price update.</li>
</ul>
<h2 id="liquidation"><a class="header" href="#liquidation">Liquidation</a></h2>
<p>Liquidation occurs when the collateralization ratio of a vault falls below its minimum. Liquidation is crucial in ensuring that all loan tokens are sufficiently over-collateralized to support its price.</p>
<p>For Turing-complete VM-based blockchain, liquidation requires the assistance of publicly run bots to trigger it, in exchange for some incentives.</p>
<p>There are two problems with that:</p>
<ul>
<li>During major price movements, the network fee, or commonly known as gas price, would sky rocket due to a race by both the vault owners frantically trying to save their vaults from getting liquidated, and by the public liquidators trying to trigger liquidation.</li>
<li>If liquidations are not triggered on time, tokens that are generated as a result of loan runs the risk of losing its values. Worse scenario would see it getting into a negative feedback loop situation creating a rapid crash of token values.</li>
</ul>
<p>DeFiChain, a blockchain that's built for specifically for DeFi, enjoy the benefit of automation and can have liquidation trigger automatically on-chain. This address the above two problems.</p>
<h3 id="methodology"><a class="header" href="#methodology">Methodology</a></h3>
<p>On every block, the node would evaluate all vaults and trigger the following automatically for liquidation.</p>
<p>When collateralization ratio of a vault falls below minimum collateralization ratio, liquidation would be triggered. During liquidation collateral auction is initiated.</p>
<p>When a vault is in liquidation mode, it can no longer be used until all the loan amount is repaid before it can be reopened. Interest accrual is also stopped during liquidation process.</p>
<h4 id="collateral-auction"><a class="header" href="#collateral-auction">Collateral auction</a></h4>
<p>The entirety of loan and collateral of a vault if put up for auction. As the first version of collateral auction requires bidding of the full amount, auction is automatically split into batches of <em>around</em> $10,000 worth each to facilitate for easier bidding.</p>
<h4 id="example"><a class="header" href="#example">Example</a></h4>
<p>A vault, that requires a minimum of 150% collateralization ratio contains $15,000 worth of collateral, which consists of $10,000 worth of DFI and $5,000 worth of BTC, and the total loan, inclusive of interest, is $11,000 worth.</p>
<ul>
<li>Collateral: $10,000 DFI + $5,000 BTC</li>
<li>Loan: $10,000 <code>TSLA</code> + $1,000 interest (<code>TSLA</code>)</li>
</ul>
<p>Collateralization ratio = 15k / 11k = 136.36% less than the required 150%. Liquidation is triggered automatically by consensus. Auction will be initiated with the intention to liquidate $15k of collateral to recover $11k of loan.</p>
<p>Liquidation penalty is defined as <code>LOAN_LIQUIDATION_PENALTY</code>. The amount to be recovered should also include the penalty. If <code>LOAN_LIQUIDATION_PENALTY</code> is 0.05, the total amount to be recovered is thus $11k * 1.05 = $11,550</p>
<p>Total collateral worth is $15k, it will thus be split into 2 batches, each not exceeding $10k:</p>
<ol>
<li>2/3 of the whole vault, worth $10k of collateral.</li>
<li>1/3 of the whole vault, worth $5k of collateral.</li>
</ol>
<p>Specifically the following:</p>
<ol>
<li>($6,667 DFI and $3,333 BTC) for $7,700 <code>TSLA</code></li>
<li>($3,333 DFI and $1,667 BTC) for $3,850 <code>TSLA</code></li>
</ol>
<p><code>TSLA</code> recovered at the conclusion of the auction will be paid back to the vault. Once all loan is repaid, vault will exit liquidation state, allowing its owner to continue to use it. It will, however, not terminate all opened auctions. Opened auctions see through to their conclusion.</p>
<h2 id="collateral-auction-1"><a class="header" href="#collateral-auction-1">Collateral auction</a></h2>
<p>Collateral auction will run for 720 blocks (approximately 6 hours) with the starting price based on liquidation vault's ratio.</p>
<p>Using the same illustration, Auction 1: ($6,667 DFI and $3,333 BTC) for $7,700 <code>TSLA</code></p>
<p>Anyone can participate in the auction, including the vault owner by bidding for the entirety of the auction with higher amount. To prevent unnecessary auction sniping at closing blocks, each higher bid, except the first one, has to be at least 1% higher than previous bid.</p>
<p>A user could bid for the same auction by offering $7,800 worth of <code>TSLA</code> tokens. During bidding, the bid is locked and refunded immediately when outbid. Top bid is not cancelable.</p>
<p>At the conclusion of the auction, the entirety of the for sale collateral will be transferred to the winner – in this case the winner would be paying $7,800 for $10,000 worth of BTC and DFI.</p>
<p>$7,800 worth of <code>TSLA</code> token will be processed as follow:</p>
<ul>
<li>Paid back to vault = $7,800 worth of <code>TSLA</code> / (1 + <code>LOAN_LIQUIDATION_PENALTY</code>) = 7800 / 1.05 = $7,428.57 <code>TSLA</code> token</li>
<li>The remaining, i.e. liquidation penalty, will be swapped to DFI and burned. $371.43 worth of <code>TSLA</code> be swapped as follows and  trackably burned:
<ol>
<li><code>TSLA</code> to <code>USD</code> from <code>TSLA-USD</code> DEX.</li>
<li><code>USD</code> to <code>DFI</code> from <code>USD-DFI</code> DEX.</li>
</ol>
</li>
</ul>
<p>If auctions yield more <code>TSLA</code> than the vault's loan, it will be deposited back to the vault as part of vault's asset, but not collateral. It can be withdrawn from the vault after vault exits liquidation state by vault's owner and carries no interest.</p>
<h3 id="multiple-loan-tokens"><a class="header" href="#multiple-loan-tokens">Multiple loan tokens</a></h3>
<p>If a vault consists of multiple loan tokens, they should be auctioned separately.</p>
<p>For instance, a liquidating vault that consists of the following:</p>
<ul>
<li>Collateral: 1 BTC &amp; 100 DFI</li>
<li>Loan: $10k worth of USD * $40k worth TSLA</li>
</ul>
<p>would be liquidated as follows:</p>
<ul>
<li>(0.2 BTC &amp; 20 DFI) for $10k worth of USD</li>
<li>(0.8 BTC &amp; 80 DFI) for $40k worth of TSLA</li>
</ul>
<p>and further split into $10k batches.</p>
<h3 id="failed-auction"><a class="header" href="#failed-auction">Failed auction</a></h3>
<p>Auction that expires after 720 blocks without bids will be reopened immediately based on the remaining amount of collateral and loan that the vault receives due to conclusion of other auction batches.</p>
<h2 id="rpc-2"><a class="header" href="#rpc-2">RPC</a></h2>
<h3 id="operator-1"><a class="header" href="#operator-1">Operator</a></h3>
<p>Requires Operator authorization. Before Operator model is ready, it uses only 1 default <a href="pinkpaper/loan/../operator">opspace</a> and requires foundation authorization.</p>
<h4 id="loan-scheme-1"><a class="header" href="#loan-scheme-1">Loan scheme</a></h4>
<ol>
<li>
<p><code>createloanscheme DATA</code></p>
<ul>
<li><code>DATA</code> (JSON) can consist of the following:
<ul>
<li><code>mincolratio</code>: e.g. 175 for 175% minimum collateralization ratio. Cannot be less than 100.</li>
<li><code>interestrate</code>: Annual rate, but chargeable per block (scaled to 30-sec block). e.g. 3.5 for 3.5% interest rate. Must be &gt; 0.</li>
<li><code>id</code>: Non-colliding scheme ID that's unique within opspace, e.g. <code>MIN_175</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>updateloanscheme MIN_COL_RATIO INTEREST_RATE SCHEME_ID [ACTIVATE_AFTER_BLOCK]</code></p>
<ul>
<li>Update loan scheme details.</li>
<li><code>ACTIVATE_AFTER_BLOCK</code> <em>(optional)</em>: If set, this will only be activated after the set block. The purpose is to allow good operators to provide sufficient warning.</li>
</ul>
</li>
<li>
<p><code>destroyloanscheme SCHEME_ID [ACTIVATE_AFTER_BLOCK]</code></p>
<ul>
<li>Destroy a loan scheme.</li>
<li><code>ACTIVATE_AFTER_BLOCK</code> <em>(optional)</em>: If set, this will only be activated after the set block. The purpose is to allow good operators to provide sufficient warning.</li>
<li>Any loans under the scheme will be moved to default loan scheme after destruction.</li>
</ul>
</li>
<li>
<p><code>setdefaultloanscheme SCHEME_ID</code></p>
<ul>
<li>Designate a default loan scheme from the available loan schemes.</li>
</ul>
</li>
</ol>
<h4 id="general"><a class="header" href="#general">General</a></h4>
<ol>
<li>
<p><code>setcollateraltoken DATA</code></p>
<ul>
<li><code>DATA</code> (JSON)
<ul>
<li><code>token</code>: Token must not be the same decentralized token is issued by the same operator's loan program.</li>
<li><code>factor</code>: A number between <code>0</code> to <code>1</code>, inclusive. <code>1</code> being 100% collateralization factor.</li>
<li><code>fixedIntervalPriceId</code>: Token/currency pair to track token price.</li>
<li><code>activateAfterBlock</code> <em>(optional)</em>: If set, this will only be activated after the set block. The purpose is to allow good operators to provide sufficient warning to their users should certain collateralization factors need to be updated.</li>
<li>This very same transaction type is also used for updating and removing of collateral token, by setting the factor to <code>0</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>setloantoken DATA</code></p>
<ul>
<li>Creates or updates loan token.</li>
<li><code>DATA</code> (JSON)
<ul>
<li><code>symbol</code>Token's symbol (unique), not longer than 8</li>
<li><code>name</code> Token's name (optional), not longer than 128</li>
<li><code>fixedIntervalPriceId</code>: Token/currency pair to track token price.</li>
<li><code>mintable</code> (bool): When this is <code>true</code>, vault owner can mint this token. (defaults to true)</li>
<li><code>interest</code>: Annual rate, but chargeable per block (scaled to 30-sec block). e.g. 3.5 for 3.5% interest rate. Must be &gt;= 0. Default: 0.</li>
</ul>
</li>
<li>To also implement <code>updateloantoken</code> and <code>listloantokens</code>.</li>
</ul>
</li>
</ol>
<h3 id="public"><a class="header" href="#public">Public</a></h3>
<p>Requires no authorizations.</p>
<ol>
<li>
<p><code>getloaninfo</code></p>
<ul>
<li>Returns the attributes of loans offered by Operator.</li>
<li>Includes especially the following:
<ul>
<li>Collateral tokens: List of collateral tokens</li>
<li>Loan tokens: List of loan tokens</li>
<li>Loan schemes: List of loan schemes</li>
<li>Collateral value (USD): Total collateral in vaults</li>
<li>Loan value (USD): Total loan token in vaults</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>listloanschemes</code></p>
<ul>
<li>Returns the list of attributes to all the available loan schemes.</li>
</ul>
</li>
</ol>
<h4 id="vault-1"><a class="header" href="#vault-1">Vault</a></h4>
<p>Vault-related, but does not require owner's authentication.</p>
<ol>
<li>
<p><code>createvault [OWNER_ADDRESS] [SCHEME_ID]</code></p>
<ul>
<li>Create a vault for <code>OWNER_ADDRESS</code>.</li>
<li>No <code>OWNER_ADDRESS</code> authorization required so that it can be used for yet-to-be-revealed script hash address.</li>
<li>2 DFIs needed for createvault.</li>
<li>1 DFI burned, and 1 added to collateral.</li>
<li>The last 1 added to collateral will be reclaimed  on closevault.</li>
</ul>
</li>
<li>
<p><code>deposittovault VAULT_ID TOKEN_TO_DEPOSIT</code></p>
<ul>
<li>Deposit accepted collateral tokens to vault.</li>
<li>Does not require authentication, anyone can top up anyone's vault.</li>
<li><code>TOKEN_TO_DEPOSIT</code> should be in similar format as other tokens on DeFiChain, e.g. <code>23.42@USDC</code> and <code>0.42@DFI</code>.</li>
<li>Also take note on the &gt;= 50% DFI requirement, when depositing a non-DFI token, it should reject if the total value of the vault's collateral after the deposit brings DFI value to less than 50% of vault's collateral.</li>
<li>This also means that the first deposit to a vault has to always be DFI.</li>
</ul>
</li>
<li>
<p><code>paybackloan DATA</code></p>
<ul>
<li><code>DATA</code> (JSON)
<ul>
<li><code>vaultId</code>: loan's vault ID.</li>
<li><code>from</code>: Address containing repayment tokens.</li>
<li><code>amounts</code>: Amounts to pay back in amount@token format.</li>
</ul>
</li>
<li>Pay back of loan token.</li>
<li>Only works when there are loans in the vault.</li>
<li>Refunds additional loan token back to original caller, if 51.1 <code>TSLA</code> is owed and user pays 52 <code>TSLA</code>, 0.9 <code>TSLA</code> is returned as change to transaction originator (not vault owner).</li>
<li>Does not require authentication, anyone can payback anyone's loan.</li>
</ul>
</li>
<li>
<p><code>getvault [VAULT_ID]</code></p>
<ul>
<li>Returns the attributes of a vault.</li>
<li>Includes especially the following:
<ul>
<li>Owner address</li>
<li>Loan scheme ID</li>
<li><code>state</code> Can be one of <code>active</code>, <code>frozen</code>, <code>inLiquidation</code> and <code>mayLiquidate</code>. See <a href="https://github.com/DeFiCh/pinkpaper/tree/main/loan#state">state</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>listvaults</code></p>
<ul>
<li>Returns the list of attributes to all the created vaults.</li>
</ul>
</li>
</ol>
<h3 id="vault-owner"><a class="header" href="#vault-owner">Vault owner</a></h3>
<p>Requires ownerAddress authentication, and vault MUST NOT be in liquidation state.</p>
<ol>
<li>
<p><code>updatevault VAULT_ID DATA</code></p>
<ul>
<li><code>DATA</code> (JSON) may consists of the following:
<ul>
<li><code>scheme</code>: Allows vault owner to switch to a different scheme</li>
<li><code>ownerAddress</code>: Transfers vault's ownership to a new address.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>withdrawfromvault VAULT_ID TO_ADDRESS AMOUNT</code></p>
<ul>
<li>Withdraw collateral tokens from vault.</li>
<li>Vault collateralization ratio must not be less than <code>mincolratio</code> of vault's scheme.</li>
<li>Also used to withdraw assets that are left in a vault due to higher auction yield. See <a href="pinkpaper/loan/index.html#collateral-auction">Collateral auction</a></li>
</ul>
</li>
<li>
<p><code>takeloan DATA</code></p>
<ul>
<li><code>DATA</code> (JSON)
<ul>
<li><code>vaultId</code>: ID of vault used for loan.</li>
<li><code>to</code>: Address to transfer tokens (optional).</li>
<li><code>amounts</code>: Amount in amount@token format.</li>
</ul>
</li>
<li>Vault collateralization ratio must not be less than <code>mincolratio</code> of vault's scheme.</li>
</ul>
</li>
</ol>
<h3 id="auction"><a class="header" href="#auction">Auction</a></h3>
<p>Requires no additional authentications.</p>
<ol>
<li>
<p><code>listauctions</code></p>
</li>
<li>
<p><code>auctionbid VAULT_ID INDEX FROM AMOUNT</code></p>
<ul>
<li>
<p><code>VAULT_ID</code>: Vault id.</p>
</li>
<li>
<p><code>INDEX</code>: Auction index.</p>
</li>
<li>
<p><code>FROM</code>: Address to get tokens.</p>
</li>
<li>
<p><code>AMOUNT</code>: Amount of amount@symbol format.</p>
</li>
<li>
<p><code>TOTAL_PRICE</code> of token in auction will be locked up until the conclusion of the auction, or refunded when outbid.</p>
</li>
</ul>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="operator-2"><a class="header" href="#operator-2">Operator</a></h1>
<h2 id="generalization"><a class="header" href="#generalization">Generalization</a></h2>
<p>Generalization effort in DeFiChain aims at separation between the role of blockchain and operator, the party in charge of offering financial products.</p>
<p>The generalization goals are to allow anyone to create and run as operator on DeFiChain, without requiring any prior permissions from DeFiChain Foundation or its developers.</p>
<h3 id="opspace"><a class="header" href="#opspace">Opspace</a></h3>
<p>Operator operates exclusively within their Opspace and does not interfere with the operations of other Opspaces and entire blockchain ecosystem.</p>
<p>To ensure operation continuity, the current asset tokens, and any other offerings that are available prior to the introduction of Operator, will be migrated to the first Opspace when the functionality is available.</p>
<h3 id="role"><a class="header" href="#role">Role</a></h3>
<p>The role and functionalities available to operators include:</p>
<ol>
<li>Price oracle</li>
</ol>
<ul>
<li>Setting of price feeds.</li>
<li>Appointing of oracles.</li>
</ul>
<ol start="2">
<li>Asset token</li>
</ol>
<ul>
<li>Determining and setting of asset tokens that are available within an opspace.</li>
<li>Previously referred to as &quot;DeFi Asset Token&quot; on white paper.</li>
</ul>
<ol start="3">
<li>Decentralized loan</li>
</ol>
<ul>
<li>Determining loan attributes: collateral types, interest rates, etc</li>
</ul>
<ol start="4">
<li>Futures</li>
</ol>
<ul>
<li>Determining future offerings &amp; attributes</li>
</ul>
<p>... and others as they are made available.</p>
<p>Operator is also free to determine their own Operator fee for all the products that they provide.</p>
<p>Note that operators may only want to participate in a subset of the operations available, for example an operator may only be interested in offering decentralized loan but not interested in offering futures.</p>
<h2 id="operations"><a class="header" href="#operations">Operations</a></h2>
<p>RPC is designed work with multisignatory opcodes of Bitcoin's script, allowing operator to have clear governance over its policies.</p>
<ol>
<li>
<p><code>createoperator</code></p>
<ul>
<li>Costs 1000 DFI in DeFi fee, burned.</li>
</ul>
</li>
<li>
<p><code>updateoperator</code></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="price-oracle"><a class="header" href="#price-oracle">Price oracle</a></h1>
<p>Even though Oracle could technically provide any off-chain data, the initial version of Oracle focuses on numeric data especially price feeds to augment various features and functionalities on DeFiChain, especially future, option &amp; loan.</p>
<h2 id="economics--game-theory"><a class="header" href="#economics--game-theory">Economics &amp; game theory</a></h2>
<p>To provide a fully robust trustless oracle service requires components such as reputation, penalty, and various other mechanics, it is not DeFiChain's current focus to build a full oracle system, at least at this stage. DeFiChain utilizes Operator and free economy to ensure that oracles are run as fairly as possible. It is Operator's interest to ensure that oracles that they appoint are fairly run, and users are free to select operators that they like.</p>
<h2 id="mechanics-1"><a class="header" href="#mechanics-1">Mechanics</a></h2>
<p>While truthfullness of the data cannot be assertained on the blockchain alone, the goals of the design should focus on building a <em>robust</em> oracle system that should continue to function fine with a few minotirty oracle outages.</p>
<h3 id="price-feeds"><a class="header" href="#price-feeds">Price feeds</a></h3>
<p>Price feed should be 8 decimal places.</p>
<p>Requires foundation authorization.</p>
<ol>
<li><code>createpricefeed BTC_USD_PRICE</code></li>
<li><code>removepricefeed BTC_USD_PRICE</code></li>
</ol>
<h3 id="oracle-appointments"><a class="header" href="#oracle-appointments">Oracle appointments</a></h3>
<p>Requires Operator authorization. Before Operator model is ready, it uses only 1 default <a href="pinkpaper/price-oracle/../operator">opspace</a> and requires foundation authorization.</p>
<ol>
<li><code>appointoracle ADDRESS '[&quot;BTC_USD_PRICE&quot;, &quot;ETH_USD_PRICE&quot;]' WEIGHTAGE</code>
<ul>
<li>returns <code>oracleid</code>. <code>oracleid</code> should be a deterministic hash and not incremental count.</li>
<li><code>WEIGHTAGE</code> is any number between 0 to 100. Default to 20.</li>
</ul>
</li>
<li><code>removeoracle ORACLEID</code></li>
<li><code>updateoracle ORACLEID ADDRESS '[&quot;BTC_USD_PRICE&quot;, &quot;ETH_USD_PRICE&quot;]' WEIGHTAGE</code></li>
</ol>
<h3 id="price-feeds-operations"><a class="header" href="#price-feeds-operations">Price feeds operations</a></h3>
<p>Requires appointed Oracle authorization.</p>
<ol>
<li><code>setrawprice TIMESTAMP '{&quot;BTC_USD_PRICE&quot;: 38293.12}'</code>
<ul>
<li>Raw price update should only be valid if timestamp is within one hour from the latest blocktime.</li>
<li>timestamp is there so that updates that are stuck in mempool for awhile does not get accepted after timeout.</li>
</ul>
</li>
</ol>
<h3 id="general-usage"><a class="header" href="#general-usage">General usage</a></h3>
<p>General usage, requires no authorizations.</p>
<ol>
<li>
<p><code>listlatestrawprices BTC_USD_PRICE</code></p>
<ul>
<li>Also supports <code>listlatestrawprices</code> to list across all feeds.</li>
<li>Returns an array of all the latest price updates, e.g.</li>
</ul>
<pre><code class="language-json">[
    {
        &quot;pricefeed&quot;: &quot;BTC_USD_PRICE&quot;,
        &quot;oracleid&quot;: &quot;ORACLEID&quot;,
        &quot;weightage&quot;: 50,
        &quot;timestamp&quot;: &quot;timestamp of the last update&quot;,
        &quot;rawprice&quot;: 38293.12000000,
        &quot;state&quot;: &quot;live&quot;
    }
]
</code></pre>
<ul>
<li>Price updates that are older than 1 hour from the latest blocktime would have its state to be <code>expired</code>.</li>
<li>It is also imperative that the node is not storing all raw price data on database, it only needs to know the latest raw price for each oracles.</li>
</ul>
</li>
<li>
<p><code>getprice BTC_USD_PRICE</code></p>
<ul>
<li>Returns number with aggregated price.</li>
<li>Aggregate price = Sum of (latest rawprice of live oracles * weightage) / Sum (live oracles' weightage)</li>
<li>If no live oracle is found for the price, it should throw an error. It MUST NOT return 0 or large number.</li>
</ul>
</li>
<li>
<p><code>listprices</code></p>
<ul>
<li>Same as above, but an array of all feeds.</li>
</ul>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blockchain-node---defid"><a class="header" href="#blockchain-node---defid">Blockchain Node - defid</a></h1>
<p>DeFiChain is a distributed network of computers running software (known as nodes).
DeFiChain nodes are able to</p>
<ul>
<li>Store all blockchain data</li>
<li>Serve data to lightweight clients</li>
<li>Validate and propogate blocks and transactions</li>
</ul>
<p>Every DeFiChain node runs an implementation of the DeFiChain protocol, and can be run on local and cloud machines. The minimum requirements for running the reference <code>defid</code> node are</p>
<ul>
<li>Desktop or laptop hardware running recent versions of Windows, Mac OS X, or Linux.</li>
<li>Atleast 5 GB of disk space</li>
<li>2 gigabytes of memory (RAM)</li>
<li>Stable internet connection with high upload limits</li>
</ul>
<p>There are two ways start using the node - using the compiled releases or compiling the souce code on your own.</p>
<h2 id="using-compiled-releases"><a class="header" href="#using-compiled-releases">Using compiled releases</a></h2>
<p>Download the latest available release from <a href="https://github.com/DeFiCh/ain/releases">Github</a>. Extract the archive by using an archive manager, or running the following command in a terminal</p>
<pre><code class="language-bash">tar xzf &lt;filename&gt;.tar.gz # replace &lt;filename&gt; with the filename downloaded file
</code></pre>
<p>You can run the following install command to globally install the DeFiChain binaries.</p>
<pre><code class="language-bash">sudo install -m 0755 -o root -g root -t /usr/local/bin &lt;defichain-path&gt;/bin/* # replace &lt;defichain-path&gt; with the path to the root of the extracted folder
</code></pre>
<p>Proceed to <a href="defid.html#initial-block-download">Initial Block Download</a>.</p>
<h2 id="compiling-from-source"><a class="header" href="#compiling-from-source">Compiling from source</a></h2>
<h3 id="using-makesh-debianubuntu-only"><a class="header" href="#using-makesh-debianubuntu-only">Using <code>make.sh</code> (Debian/Ubuntu only)</a></h3>
<p>By running <code>./make.sh build</code> will download install required dependencies and run the complete compilation process. Run <code>make install</code> at the end of the process to make the compiled binaries available globally.</p>
<h3 id="compiling-manually"><a class="header" href="#compiling-manually">Compiling manually</a></h3>
<p>Install <code>gcc</code> and <code>boost</code> and other dependecies from your distribution's package manager.</p>
<p>Arch Linux: <code>sudo pacman -S gcc boost libevent python</code>.</p>
<p>Debian/Ubuntu: <code>sudo apt-get install build-essential libtool autotools-dev automake pkg-config bsdmainutils python3 curl ibssl-dev libevent-dev libboost-system-dev libboost-filesystem-dev libboost-chrono-dev libboost-test-dev libboost-thread-dev</code></p>
<p>Clone the latest version of <code>ain</code> from GitHub.</p>
<pre><code class="language-bash">git clone https://github.com/DeFiCh/ain.git
cd ain
</code></pre>
<p>Install Berekely DB.</p>
<pre><code class="language-bash">./contrib/install_db4.sh `pwd`
</code></pre>
<p>Once installation is complete, take note of the commands provided at the end of the build log.</p>
<pre><code class="language-bash">db4 build complete.

When compiling defid, run `./configure` in the following way:

  export BDB_PREFIX='/home/DeFiCha/ain/contrib/db4'
  ./configure BDB_LIBS=&quot;-L${BDB_PREFIX}/lib -ldb_cxx-4.8&quot; BDB_CFLAGS=&quot;-I${BDB_PREFIX}/include&quot; ...
</code></pre>
<p>Now, run the export command from the DB compilation, then run <code>autogen.sh</code> and finally run the configure command from above.</p>
<pre><code class="language-bash">export BDB_PREFIX='/home/DeFiCha/ain/contrib/db4'
./autogen.sh
./configure BDB_LIBS=&quot;-L${BDB_PREFIX}/lib -ldb_cxx-4.8&quot; BDB_CFLAGS=&quot;-I${BDB_PREFIX}/include&quot;
</code></pre>
<p>We can now compile the node. Run <code>make</code> in the <code>ain</code> root directory.</p>
<pre><code class="language-bash">make #
make -j &quot;$(($(nproc)))&quot; # for multicore CPUs
</code></pre>
<p><code>defi-d</code> and other DeFiChain executable will now be in the <code>src/</code> directory. You can run <code>make install</code> to access the compiled binaries globally.</p>
<p>Proceed to <a href="defid.html#initial-block-download">Initial Block Download</a>.</p>
<h2 id="initial-block-download"><a class="header" href="#initial-block-download">Initial Block Download</a></h2>
<p>Once you have the required binaries available, you can start the node by running the following commands in the folder with the executables.</p>
<p>Linux and macOS: <code>./defid</code>
Windows: <code>defid.exe</code></p>
<p>This will start the node and the software will begin syncing blockchain data. Your wallets and transaction history will not be visible until the blockchain has been completely synced and up to date with the rest of the nodes. Currently the blockchain takes up <strong>around 4GB</strong> of disk space.</p>
<p>In order to speed up the process, you can download a snapshot from AWS.</p>
<ol>
<li>Stop the <code>defid</code> process.</li>
<li>Go to <a href="https://defi-snapshots.s3.ap-southeast-1.amazonaws.com/index.txt">the AWS bucket</a> and copy the filename of the latest (bottom most) snapshot.</li>
<li>Replace <code>index.txt</code> in the URL with the filename from the previous step.</li>
<li>Extract the contents of the downloaded <code>.zip</code> file.</li>
<li>Copy the extracted contents into the <code>.defi</code> folder.
<ul>
<li>Windows: <code>C:\Users\&lt;username&gt;\AppData\Roaming\DeFi Blockchain</code></li>
<li>Linux and macOS: <code>~/.defi/</code></li>
</ul>
</li>
<li>Now restart the <code>defi</code> process. There will be a short syncing process to get the node up to date with the rest of the network.</li>
</ol>
<h2 id="interacting-with-the-node"><a class="header" href="#interacting-with-the-node">Interacting with the node</a></h2>
<p>Once <code>defid</code> is running, you interact with the node on a different terminal using the <code>defi-cli</code> application. You can run <code>./defi-cli help</code> to see a list of available commands.</p>
<p>Proceed to <a href="./node/wallet.html">Using a wallet</a> to learn how to get started with using the node.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-a-wallet"><a class="header" href="#using-a-wallet">Using a wallet</a></h1>
<p>This document will go over how to create a wallet and addresses in order to send and recieve DFI and dTokens.</p>
<h2 id="using-testnet"><a class="header" href="#using-testnet">Using testnet</a></h2>
<p>In this tutorial we will use the testnet network in order to prevent any possibility of financial loss. Testnet is a separate network from mainnet for the purpose of testing. To use the testnet, stop the <code>defid</code> process, if any, and re-run it with the <code>-testnet</code> flag.</p>
<p>Linux and macOS: <code>./defid -testnet</code></p>
<p>Windows: <code>defid.exe -testnet</code></p>
<p>To verify that you are on the testnet, run <code>./defi-cli -testnet getblockchaininfo</code>. You should see an output similar to the following</p>
<pre><code>{
  &quot;chain&quot;: &quot;test&quot;,
  &quot;blocks&quot;: 919519,
  &quot;headers&quot;: 934011,
....
  },
  &quot;warnings&quot;: &quot;&quot;
}
</code></pre>
<p>If you see <code>&quot;chain&quot;: &quot;test&quot;</code>, you are on the testnet!</p>
<h2 id="creating-an-address"><a class="header" href="#creating-an-address">Creating an address</a></h2>
<p>To create an address, run</p>
<pre><code class="language-bash">./defi-cli -testnet getnewaddress
</code></pre>
<p>This will return a new DeFiChain address that you can use to recieve DFI and dTokens.</p>
<pre><code>tnLRVU32vCfGD6...
</code></pre>
<p>You will also require the private keys to this address in order to access your funds. Use the <code>dumpprivkey</code> command to retrieve the private key.</p>
<pre><code class="language-bash">./defi-cli -testnet dumpprivkey
</code></pre>
<p>This will return the corresponding private key to the input address.</p>
<pre><code>cRomqYvttzcXHq...
</code></pre>
<p><strong>Do not share your private keys with anyone.</strong></p>
<p>You can run the <code>listreceivedbyaddress</code> command to see available addresses and the amount of DFI available to each address.</p>
<pre><code>./defi-cli -testnet listreceivedbyaddress 1 true
</code></pre>
<p>Here the first parameter sets the minimum number of confirmations required to include the transaction, and the second parameters enables/disables addresses if they have 0 tokens. After running the command, you should be able to see the following output.</p>
<pre><code>[
  {
    &quot;address&quot;: &quot;tnLRVU32vCfGD6...&quot;,
    &quot;amount&quot;: 0.00000000,
    &quot;confirmations&quot;: 0,
    &quot;label&quot;: &quot;&quot;,
    &quot;txids&quot;: [
    ]
  }
]
</code></pre>
<p>You can also use the <code>getwalletinfo</code> command to see aggregate information if you have generated multiple addresses.</p>
<pre><code>./defi-cli -testnet getwalletinfo
</code></pre>
<pre><code>{
  &quot;walletname&quot;: &quot;&quot;,
  &quot;walletversion&quot;: 169900,
  &quot;balance&quot;: 0.00000000,
  &quot;unconfirmed_balance&quot;: 0.00000000,
  &quot;immature_balance&quot;: 0.00000000,
  &quot;txcount&quot;: 4,
  &quot;keypoololdest&quot;: 1646714869,
  &quot;keypoolsize&quot;: 999,
  &quot;keypoolsize_hd_internal&quot;: 1000,
  &quot;paytxfee&quot;: 0.00000000,
  &quot;hdseedid&quot;: &quot;c43d012bb7c93cd9129dfc42b6643de774b2502f&quot;,
  &quot;private_keys_enabled&quot;: true,
  &quot;avoid_reuse&quot;: false,
  &quot;scanning&quot;: false
}
</code></pre>
<h2 id="getting-some-testnet-dfi"><a class="header" href="#getting-some-testnet-dfi">Getting some testnet DFI</a></h2>
<h2 id="creating-a-transaction"><a class="header" href="#creating-a-transaction">Creating a transaction</a></h2>
<p>Once you have some DFI in your wallet, you use it to create a vault and mint dTokens, or send it to other addresses. There are two options to create a transaction, writing a raw transaction or using the P2PKH template. We will go over sending DFI to another address using the P2PKH template.</p>
<p>Verify your wallet balance using the <code>getbalance</code> command.</p>
<pre><code>./defi-cli -testnet getbalance
</code></pre>
<pre><code>39999.99999160
</code></pre>
<p>You can now use the <code>sendtoaddress</code> command to send DFI.</p>
<pre><code>./defi-cli -testnet sendtoaddress tiiUqg4TqGR7ja... 1
</code></pre>
<p>The value after the address sets the amount of DFI to transfer. The command will output the new transaction ID.</p>
<pre><code>23ee92302e166daf540d358fa726d52ff391f9f3058636ca45d887c747cd8610
</code></pre>
<p>You can inspect the transaction using the <code>gettransaction</code> or <code>getrawtransaction</code> command.</p>
<pre><code>./defi-cli -testnet gettransaction 23ee92302e166daf540d358fa726d52ff391f9f3058636ca45d887c747cd8610
./defi-cli -testnet getrawtransaction 23ee92302e166daf540d358fa726d52ff391f9f3058636ca45d887c747cd8610 true dbbe9b1e4f116d9316a9d1dc024fd4301b72e1f18ed1706fb59711315844a7ff
                                        ^transaction hash                                               ^verbosity          ^block hash
</code></pre>
<p>Sample output for <code>gettransaction</code></p>
<pre><code>{
  &quot;amount&quot;: 0.00000000,
  &quot;fee&quot;: -0.00000840,
  &quot;confirmations&quot;: 4,
  &quot;blockhash&quot;: &quot;dbbe9b1e4f116d9316a9d1dc024fd4301b72e1f18ed1706fb59711315844a7ff&quot;,
  &quot;blockindex&quot;: 1,
  &quot;blocktime&quot;: 1647880878,
  &quot;txid&quot;: &quot;23ee92302e166daf540d358fa726d52ff391f9f3058636ca45d887c747cd8610&quot;,
  &quot;walletconflicts&quot;: [
  ],
  &quot;time&quot;: 1647880831,
  &quot;timereceived&quot;: 1647880831,
  &quot;bip125-replaceable&quot;: &quot;no&quot;,
  &quot;details&quot;: [
    {
      &quot;address&quot;: &quot;tnLRVU32vCfGD6BB5TywSBgHwre84WrZK8&quot;,
      &quot;category&quot;: &quot;send&quot;,
      &quot;amount&quot;: -1.00000000,
      &quot;label&quot;: &quot;&quot;,
      &quot;vout&quot;: 0,
      &quot;fee&quot;: -0.00000840,
      &quot;abandoned&quot;: false
    },
    {
      &quot;address&quot;: &quot;tnLRVU32vCfGD6BB5TywSBgHwre84WrZK8&quot;,
      &quot;category&quot;: &quot;receive&quot;,
      &quot;amount&quot;: 1.00000000,
      &quot;label&quot;: &quot;&quot;,
      &quot;vout&quot;: 0
    }
  ],
  &quot;hex&quot;: &quot;04000000000101a421ebc69f999ea8db7e0322994965518a28e0ed109880bfd9b51a080242586a0000000017160014bf34bd468bc453c1bcce04445bdcd9e1a9838d11feffffff0200e1f5050000000017a914b04e136a8b1618588d89fc7cb8a473059f152fe587007028afcee800000017a9140d935d41bb352dc51b3cf74cf4b74fa322870bf087000247304402204e597c4f7bb4345291dc8aa279015bc878a0da47f1f6886015d78bd69a9def8902202a6db23424d34a303643c8246901febe45adc8c2d261e8c029c49d9a090c12070121020f01f4b43f304835d9860fe1ab874962c9dc4093a5264547b708b6b174a1627aaf400e00&quot;
}
</code></pre>
<p>The other address should recieve the tokens as soon as the transaction is included in a block!</p>
<h2 id="security"><a class="header" href="#security">Security</a></h2>
<p>Your wallet is <strong>not encrypted by default</strong>. This means that anyone with physical access to your computer or wallet file will be able to access your funds. For any wallets with real DFI or dTokens, make use of the <code>encryptwallet</code> command to encrypt your wallet, and use <code>walletlock</code> lock your wallet with a password and prevent hackers from accessing your funds.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="releases"><a class="header" href="#releases">Releases</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
    </body>
</html>
