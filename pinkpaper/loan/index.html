<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Loan - DeFiChain Handbook</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../prelude.html">Prelude</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Introduction</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">1.1.</strong> Getting Started</div></li></ol></li><li class="chapter-item expanded "><a href="../../concepts.html"><strong aria-hidden="true">2.</strong> Concepts</a></li><li class="chapter-item expanded "><a href="../../proto.html"><strong aria-hidden="true">3.</strong> Protocol and Network</a></li><li class="chapter-item expanded "><a href="../../pinkpaper/index.html"><strong aria-hidden="true">4.</strong> Pink Paper</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../pinkpaper/emission/index.html"><strong aria-hidden="true">4.1.</strong> Emission</a></li><li class="chapter-item expanded "><a href="../../pinkpaper/fees/index.html"><strong aria-hidden="true">4.2.</strong> Fees</a></li><li class="chapter-item expanded "><a href="../../pinkpaper/futures/index.html"><strong aria-hidden="true">4.3.</strong> Futures</a></li><li class="chapter-item expanded "><a href="../../pinkpaper/governance/index.html"><strong aria-hidden="true">4.4.</strong> Governance</a></li><li class="chapter-item expanded "><a href="../../pinkpaper/interchain-exchange/index.html"><strong aria-hidden="true">4.5.</strong> Interchain Exchange</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../pinkpaper/interchain-exchange/fees.html"><strong aria-hidden="true">4.5.1.</strong> Fees</a></li></ol></li><li class="chapter-item expanded "><a href="../../pinkpaper/loan/index.html" class="active"><strong aria-hidden="true">4.6.</strong> Loan</a></li><li class="chapter-item expanded "><a href="../../pinkpaper/operator/index.html"><strong aria-hidden="true">4.7.</strong> Operator</a></li><li class="chapter-item expanded "><a href="../../pinkpaper/price-oracle/index.html"><strong aria-hidden="true">4.8.</strong> Price Oracle</a></li></ol></li><li class="chapter-item expanded "><a href="../../defid.html"><strong aria-hidden="true">5.</strong> Reference Node - defid</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../node/wallet.html"><strong aria-hidden="true">5.1.</strong> Using a Wallet</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.</strong> Drafts</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../drafts/releases.html"><strong aria-hidden="true">5.2.1.</strong> Releases</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.2.</strong> Code Conventions</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.3.</strong> Git Conventions</div></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Applications</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> Wallets</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Resources</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DeFiChain Handbook</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/DeFiCh/handbook/tree/main/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/DeFiCh/handbook/edit/main/src/pinkpaper/loan/README.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="loan-and-decentralized-tokenization"><a class="header" href="#loan-and-decentralized-tokenization">Loan and Decentralized Tokenization</a></h1>
<p>Loan is be offered by <a href="../operator">operator</a> to allow decentralized price-tracking tokens to be created by users.</p>
<p>Before Operator model is ready, it uses only 1 default <a href="../operator">opspace</a> and requires foundation authorization, that acts on behalf of community.</p>
<p>Possibility of tokens being offered in a decentralized manner can be of many types, including but not limited to:</p>
<ol>
<li>Cryptocurrency such as <code>BTC</code>, <code>ETH</code>, <code>LTC</code>, etc.</li>
<li>Stablecoin such as <code>USD</code>, <code>EUR</code> tokens, etc.</li>
<li>Stocks token such as <code>TSLA</code>, <code>MSFT</code>, etc.</li>
<li>Other asset tokens.</li>
</ol>
<h2 id="concepts"><a class="header" href="#concepts">Concepts</a></h2>
<h3 id="collateralization-ratio"><a class="header" href="#collateralization-ratio">Collateralization ratio</a></h3>
<p>Loan on DeFiChain operates on over-collateralization mechanism. User first has to open a vault to mint tokens.</p>
<p>Collateralization is calculated for each vaults, using the following formula:</p>
<pre><code>Collateralization ratio =
    Total effective value of collateral /
    (Total value of tokens minted + Total interest)
</code></pre>
<p>For example, if a vault holds $200 worth of collateral asset, with $90 minted tokens and $10 of total interest accrued, the collateralization ratio is 200 / (90 + 10) = 2.</p>
<p>This is not to be confused with <em>collateralization factor</em>.</p>
<h3 id="collateralization-factor"><a class="header" href="#collateralization-factor">Collateralization factor</a></h3>
<p>Assets that are accepted for collateralization could be accepted at different collateralization factor, from 0% to 100%. When an asset collateralization factor is 100%, the entirety of the asset's value contributes to the collateralization value of the vault, however, if an asset collateralization factor is say 50%, then only half of its value contributes to the total vault's collateral.</p>
<p>For example if <code>DOGE</code> is accepted at 70% collateralization factor, $100 of <code>DOGE</code> would contribute to $70 of collateral value in a vault.</p>
<p>This is not to be confused with <em>collateralization ratio</em>.</p>
<h3 id="operator"><a class="header" href="#operator">Operator</a></h3>
<p>Operator plays to role to decide on the following:</p>
<ol>
<li>Collateral tokens and their respective collateralization values.
<ul>
<li>For instance, an Operator can decide to allow users to start a Vault in their opspace with the following collateralization factors:
<ul>
<li><code>DFI</code> at 100% collateralization factor</li>
<li><code>BTC</code> at 100% collateralization factor</li>
<li><code>DOGE</code> at 70% collateralization factor</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>Operator, also via opspace's governance values, can decide the following:</p>
<ul>
<li><code>LOAN_LIQUIDATION_PENALTY</code>: 0.05 (default), for 5% liquidation penalty. This is converted into DFI upon liquidation and burned.</li>
</ul>
<h3 id="loan-scheme"><a class="header" href="#loan-scheme">Loan scheme</a></h3>
<p>Loan scheme allows an operator to set up different loan schemes under the same Operator. Loan schemes allows an operator to define the following:</p>
<ul>
<li>Collateral token and different collateralization factor</li>
<li>Loan interest rates</li>
</ul>
<p>For example, a series of loan schemes could be made available:</p>
<ol>
<li>Min collateralization ratio: 150%. Interest rate: 5% APR.</li>
<li>Min collateralization ratio: 175%. Interest rate: 3% APR.</li>
<li>Min collateralization ratio: 200%. Interest rate: 2% APR.</li>
<li>Min collateralization ratio: 350%. Interest rate: 1.5% APR.</li>
<li>Min collateralization ratio: 500%. Interest rate: 1% APR.</li>
<li>Min collateralization ratio: 1000%. Interest rate: 0.5% APR.</li>
</ol>
<p>Vault owner can define which loan scheme to subscribe to during initial vault creation and can move it freely after that. Take caution though that if you move to a scheme with lower collateralization ratio, liquidation might be triggered.</p>
<h3 id="interest-rate"><a class="header" href="#interest-rate">Interest rate</a></h3>
<p>Interest rate for loan consists of 2 parts:</p>
<ul>
<li>Vault interest, based on loan scheme of individual vaults</li>
<li>Token interest, based on loan tokens, e.g. <code>TSLA</code> token might have its own interest that is chargeable only for <code>TSLA</code> token.</li>
</ul>
<p><a href="../fees">DeFi fees</a> are burned. Fees are typically collected in the form of the loan token repayment, and automatically swapped on DEX for DFI to be burned.</p>
<p>For example, if a loan of 100 <code>TSLA</code> is taken out and repaid back exactly 6 months later with the APR of 2%, the user will have to repay 101 <code>TSLA</code> during redemption to regain full access of collateral in the vault.</p>
<p>100 <code>TSLA</code> will be burned as part of the repayment process. 1 <code>TSLA</code> that forms the interest payment will be swapped on DEX for DFI. The resulting DFI will burned. All of these occur atomically as part of DeFiChain consensus.</p>
<h3 id="vault"><a class="header" href="#vault">Vault</a></h3>
<p>User is able to freely open a vault and deposit tokens to a vault. Vault is transferable to other owners, including being controlled by multisig address.</p>
<h3 id="collateral-dfi-requirement"><a class="header" href="#collateral-dfi-requirement">Collateral DFI requirement</a></h3>
<p>Vault's collateral requires at least 50% of it to be DFI.</p>
<p>When depositing non-DFI collateral to a vault, it needs to ensure that the resulting DFI proportion of for vault's collateral is at least 50% or more, or the deposit transaction should fail.</p>
<p>This requirement is only checked upon deposited and does not play a role in liquidation. For instance, if at the time of posit, a vault's DFI collateral is 52%, but falls to 49% without any further deposit. This WILL NOT trigger liquidation as long as vault's minimum collateralization ratio condition is still met.</p>
<h3 id="states"><a class="header" href="#states">States</a></h3>
<ul>
<li>&quot;active&quot; : Vault is above its collateralization ratio and both collaterals and loans price feeds are valid.</li>
<li>&quot;frozen&quot; : Any of collateral or loan price feed is invalid. No action can be undertaken while vault is frozen.</li>
<li>&quot;inLiquidation&quot; : Vault is under liquidation and has undergoing auctions.</li>
<li>&quot;mayLiquidate&quot; : Vault will liquidate at the next price update.</li>
</ul>
<h2 id="liquidation"><a class="header" href="#liquidation">Liquidation</a></h2>
<p>Liquidation occurs when the collateralization ratio of a vault falls below its minimum. Liquidation is crucial in ensuring that all loan tokens are sufficiently over-collateralized to support its price.</p>
<p>For Turing-complete VM-based blockchain, liquidation requires the assistance of publicly run bots to trigger it, in exchange for some incentives.</p>
<p>There are two problems with that:</p>
<ul>
<li>During major price movements, the network fee, or commonly known as gas price, would sky rocket due to a race by both the vault owners frantically trying to save their vaults from getting liquidated, and by the public liquidators trying to trigger liquidation.</li>
<li>If liquidations are not triggered on time, tokens that are generated as a result of loan runs the risk of losing its values. Worse scenario would see it getting into a negative feedback loop situation creating a rapid crash of token values.</li>
</ul>
<p>DeFiChain, a blockchain that's built for specifically for DeFi, enjoy the benefit of automation and can have liquidation trigger automatically on-chain. This address the above two problems.</p>
<h3 id="methodology"><a class="header" href="#methodology">Methodology</a></h3>
<p>On every block, the node would evaluate all vaults and trigger the following automatically for liquidation.</p>
<p>When collateralization ratio of a vault falls below minimum collateralization ratio, liquidation would be triggered. During liquidation collateral auction is initiated.</p>
<p>When a vault is in liquidation mode, it can no longer be used until all the loan amount is repaid before it can be reopened. Interest accrual is also stopped during liquidation process.</p>
<h4 id="collateral-auction"><a class="header" href="#collateral-auction">Collateral auction</a></h4>
<p>The entirety of loan and collateral of a vault if put up for auction. As the first version of collateral auction requires bidding of the full amount, auction is automatically split into batches of <em>around</em> $10,000 worth each to facilitate for easier bidding.</p>
<h4 id="example"><a class="header" href="#example">Example</a></h4>
<p>A vault, that requires a minimum of 150% collateralization ratio contains $15,000 worth of collateral, which consists of $10,000 worth of DFI and $5,000 worth of BTC, and the total loan, inclusive of interest, is $11,000 worth.</p>
<ul>
<li>Collateral: $10,000 DFI + $5,000 BTC</li>
<li>Loan: $10,000 <code>TSLA</code> + $1,000 interest (<code>TSLA</code>)</li>
</ul>
<p>Collateralization ratio = 15k / 11k = 136.36% less than the required 150%. Liquidation is triggered automatically by consensus. Auction will be initiated with the intention to liquidate $15k of collateral to recover $11k of loan.</p>
<p>Liquidation penalty is defined as <code>LOAN_LIQUIDATION_PENALTY</code>. The amount to be recovered should also include the penalty. If <code>LOAN_LIQUIDATION_PENALTY</code> is 0.05, the total amount to be recovered is thus $11k * 1.05 = $11,550</p>
<p>Total collateral worth is $15k, it will thus be split into 2 batches, each not exceeding $10k:</p>
<ol>
<li>2/3 of the whole vault, worth $10k of collateral.</li>
<li>1/3 of the whole vault, worth $5k of collateral.</li>
</ol>
<p>Specifically the following:</p>
<ol>
<li>($6,667 DFI and $3,333 BTC) for $7,700 <code>TSLA</code></li>
<li>($3,333 DFI and $1,667 BTC) for $3,850 <code>TSLA</code></li>
</ol>
<p><code>TSLA</code> recovered at the conclusion of the auction will be paid back to the vault. Once all loan is repaid, vault will exit liquidation state, allowing its owner to continue to use it. It will, however, not terminate all opened auctions. Opened auctions see through to their conclusion.</p>
<h2 id="collateral-auction-1"><a class="header" href="#collateral-auction-1">Collateral auction</a></h2>
<p>Collateral auction will run for 720 blocks (approximately 6 hours) with the starting price based on liquidation vault's ratio.</p>
<p>Using the same illustration, Auction 1: ($6,667 DFI and $3,333 BTC) for $7,700 <code>TSLA</code></p>
<p>Anyone can participate in the auction, including the vault owner by bidding for the entirety of the auction with higher amount. To prevent unnecessary auction sniping at closing blocks, each higher bid, except the first one, has to be at least 1% higher than previous bid.</p>
<p>A user could bid for the same auction by offering $7,800 worth of <code>TSLA</code> tokens. During bidding, the bid is locked and refunded immediately when outbid. Top bid is not cancelable.</p>
<p>At the conclusion of the auction, the entirety of the for sale collateral will be transferred to the winner – in this case the winner would be paying $7,800 for $10,000 worth of BTC and DFI.</p>
<p>$7,800 worth of <code>TSLA</code> token will be processed as follow:</p>
<ul>
<li>Paid back to vault = $7,800 worth of <code>TSLA</code> / (1 + <code>LOAN_LIQUIDATION_PENALTY</code>) = 7800 / 1.05 = $7,428.57 <code>TSLA</code> token</li>
<li>The remaining, i.e. liquidation penalty, will be swapped to DFI and burned. $371.43 worth of <code>TSLA</code> be swapped as follows and  trackably burned:
<ol>
<li><code>TSLA</code> to <code>USD</code> from <code>TSLA-USD</code> DEX.</li>
<li><code>USD</code> to <code>DFI</code> from <code>USD-DFI</code> DEX.</li>
</ol>
</li>
</ul>
<p>If auctions yield more <code>TSLA</code> than the vault's loan, it will be deposited back to the vault as part of vault's asset, but not collateral. It can be withdrawn from the vault after vault exits liquidation state by vault's owner and carries no interest.</p>
<h3 id="multiple-loan-tokens"><a class="header" href="#multiple-loan-tokens">Multiple loan tokens</a></h3>
<p>If a vault consists of multiple loan tokens, they should be auctioned separately.</p>
<p>For instance, a liquidating vault that consists of the following:</p>
<ul>
<li>Collateral: 1 BTC &amp; 100 DFI</li>
<li>Loan: $10k worth of USD * $40k worth TSLA</li>
</ul>
<p>would be liquidated as follows:</p>
<ul>
<li>(0.2 BTC &amp; 20 DFI) for $10k worth of USD</li>
<li>(0.8 BTC &amp; 80 DFI) for $40k worth of TSLA</li>
</ul>
<p>and further split into $10k batches.</p>
<h3 id="failed-auction"><a class="header" href="#failed-auction">Failed auction</a></h3>
<p>Auction that expires after 720 blocks without bids will be reopened immediately based on the remaining amount of collateral and loan that the vault receives due to conclusion of other auction batches.</p>
<h2 id="rpc"><a class="header" href="#rpc">RPC</a></h2>
<h3 id="operator-1"><a class="header" href="#operator-1">Operator</a></h3>
<p>Requires Operator authorization. Before Operator model is ready, it uses only 1 default <a href="../operator">opspace</a> and requires foundation authorization.</p>
<h4 id="loan-scheme-1"><a class="header" href="#loan-scheme-1">Loan scheme</a></h4>
<ol>
<li>
<p><code>createloanscheme DATA</code></p>
<ul>
<li><code>DATA</code> (JSON) can consist of the following:
<ul>
<li><code>mincolratio</code>: e.g. 175 for 175% minimum collateralization ratio. Cannot be less than 100.</li>
<li><code>interestrate</code>: Annual rate, but chargeable per block (scaled to 30-sec block). e.g. 3.5 for 3.5% interest rate. Must be &gt; 0.</li>
<li><code>id</code>: Non-colliding scheme ID that's unique within opspace, e.g. <code>MIN_175</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>updateloanscheme MIN_COL_RATIO INTEREST_RATE SCHEME_ID [ACTIVATE_AFTER_BLOCK]</code></p>
<ul>
<li>Update loan scheme details.</li>
<li><code>ACTIVATE_AFTER_BLOCK</code> <em>(optional)</em>: If set, this will only be activated after the set block. The purpose is to allow good operators to provide sufficient warning.</li>
</ul>
</li>
<li>
<p><code>destroyloanscheme SCHEME_ID [ACTIVATE_AFTER_BLOCK]</code></p>
<ul>
<li>Destroy a loan scheme.</li>
<li><code>ACTIVATE_AFTER_BLOCK</code> <em>(optional)</em>: If set, this will only be activated after the set block. The purpose is to allow good operators to provide sufficient warning.</li>
<li>Any loans under the scheme will be moved to default loan scheme after destruction.</li>
</ul>
</li>
<li>
<p><code>setdefaultloanscheme SCHEME_ID</code></p>
<ul>
<li>Designate a default loan scheme from the available loan schemes.</li>
</ul>
</li>
</ol>
<h4 id="general"><a class="header" href="#general">General</a></h4>
<ol>
<li>
<p><code>setcollateraltoken DATA</code></p>
<ul>
<li><code>DATA</code> (JSON)
<ul>
<li><code>token</code>: Token must not be the same decentralized token is issued by the same operator's loan program.</li>
<li><code>factor</code>: A number between <code>0</code> to <code>1</code>, inclusive. <code>1</code> being 100% collateralization factor.</li>
<li><code>fixedIntervalPriceId</code>: Token/currency pair to track token price.</li>
<li><code>activateAfterBlock</code> <em>(optional)</em>: If set, this will only be activated after the set block. The purpose is to allow good operators to provide sufficient warning to their users should certain collateralization factors need to be updated.</li>
<li>This very same transaction type is also used for updating and removing of collateral token, by setting the factor to <code>0</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>setloantoken DATA</code></p>
<ul>
<li>Creates or updates loan token.</li>
<li><code>DATA</code> (JSON)
<ul>
<li><code>symbol</code>Token's symbol (unique), not longer than 8</li>
<li><code>name</code> Token's name (optional), not longer than 128</li>
<li><code>fixedIntervalPriceId</code>: Token/currency pair to track token price.</li>
<li><code>mintable</code> (bool): When this is <code>true</code>, vault owner can mint this token. (defaults to true)</li>
<li><code>interest</code>: Annual rate, but chargeable per block (scaled to 30-sec block). e.g. 3.5 for 3.5% interest rate. Must be &gt;= 0. Default: 0.</li>
</ul>
</li>
<li>To also implement <code>updateloantoken</code> and <code>listloantokens</code>.</li>
</ul>
</li>
</ol>
<h3 id="public"><a class="header" href="#public">Public</a></h3>
<p>Requires no authorizations.</p>
<ol>
<li>
<p><code>getloaninfo</code></p>
<ul>
<li>Returns the attributes of loans offered by Operator.</li>
<li>Includes especially the following:
<ul>
<li>Collateral tokens: List of collateral tokens</li>
<li>Loan tokens: List of loan tokens</li>
<li>Loan schemes: List of loan schemes</li>
<li>Collateral value (USD): Total collateral in vaults</li>
<li>Loan value (USD): Total loan token in vaults</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>listloanschemes</code></p>
<ul>
<li>Returns the list of attributes to all the available loan schemes.</li>
</ul>
</li>
</ol>
<h4 id="vault-1"><a class="header" href="#vault-1">Vault</a></h4>
<p>Vault-related, but does not require owner's authentication.</p>
<ol>
<li>
<p><code>createvault [OWNER_ADDRESS] [SCHEME_ID]</code></p>
<ul>
<li>Create a vault for <code>OWNER_ADDRESS</code>.</li>
<li>No <code>OWNER_ADDRESS</code> authorization required so that it can be used for yet-to-be-revealed script hash address.</li>
<li>2 DFIs needed for createvault.</li>
<li>1 DFI burned, and 1 added to collateral.</li>
<li>The last 1 added to collateral will be reclaimed  on closevault.</li>
</ul>
</li>
<li>
<p><code>deposittovault VAULT_ID TOKEN_TO_DEPOSIT</code></p>
<ul>
<li>Deposit accepted collateral tokens to vault.</li>
<li>Does not require authentication, anyone can top up anyone's vault.</li>
<li><code>TOKEN_TO_DEPOSIT</code> should be in similar format as other tokens on DeFiChain, e.g. <code>23.42@USDC</code> and <code>0.42@DFI</code>.</li>
<li>Also take note on the &gt;= 50% DFI requirement, when depositing a non-DFI token, it should reject if the total value of the vault's collateral after the deposit brings DFI value to less than 50% of vault's collateral.</li>
<li>This also means that the first deposit to a vault has to always be DFI.</li>
</ul>
</li>
<li>
<p><code>paybackloan DATA</code></p>
<ul>
<li><code>DATA</code> (JSON)
<ul>
<li><code>vaultId</code>: loan's vault ID.</li>
<li><code>from</code>: Address containing repayment tokens.</li>
<li><code>amounts</code>: Amounts to pay back in amount@token format.</li>
</ul>
</li>
<li>Pay back of loan token.</li>
<li>Only works when there are loans in the vault.</li>
<li>Refunds additional loan token back to original caller, if 51.1 <code>TSLA</code> is owed and user pays 52 <code>TSLA</code>, 0.9 <code>TSLA</code> is returned as change to transaction originator (not vault owner).</li>
<li>Does not require authentication, anyone can payback anyone's loan.</li>
</ul>
</li>
<li>
<p><code>getvault [VAULT_ID]</code></p>
<ul>
<li>Returns the attributes of a vault.</li>
<li>Includes especially the following:
<ul>
<li>Owner address</li>
<li>Loan scheme ID</li>
<li><code>state</code> Can be one of <code>active</code>, <code>frozen</code>, <code>inLiquidation</code> and <code>mayLiquidate</code>. See <a href="https://github.com/DeFiCh/pinkpaper/tree/main/loan#state">state</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>listvaults</code></p>
<ul>
<li>Returns the list of attributes to all the created vaults.</li>
</ul>
</li>
</ol>
<h3 id="vault-owner"><a class="header" href="#vault-owner">Vault owner</a></h3>
<p>Requires ownerAddress authentication, and vault MUST NOT be in liquidation state.</p>
<ol>
<li>
<p><code>updatevault VAULT_ID DATA</code></p>
<ul>
<li><code>DATA</code> (JSON) may consists of the following:
<ul>
<li><code>scheme</code>: Allows vault owner to switch to a different scheme</li>
<li><code>ownerAddress</code>: Transfers vault's ownership to a new address.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>withdrawfromvault VAULT_ID TO_ADDRESS AMOUNT</code></p>
<ul>
<li>Withdraw collateral tokens from vault.</li>
<li>Vault collateralization ratio must not be less than <code>mincolratio</code> of vault's scheme.</li>
<li>Also used to withdraw assets that are left in a vault due to higher auction yield. See <a href="#collateral-auction">Collateral auction</a></li>
</ul>
</li>
<li>
<p><code>takeloan DATA</code></p>
<ul>
<li><code>DATA</code> (JSON)
<ul>
<li><code>vaultId</code>: ID of vault used for loan.</li>
<li><code>to</code>: Address to transfer tokens (optional).</li>
<li><code>amounts</code>: Amount in amount@token format.</li>
</ul>
</li>
<li>Vault collateralization ratio must not be less than <code>mincolratio</code> of vault's scheme.</li>
</ul>
</li>
</ol>
<h3 id="auction"><a class="header" href="#auction">Auction</a></h3>
<p>Requires no additional authentications.</p>
<ol>
<li>
<p><code>listauctions</code></p>
</li>
<li>
<p><code>auctionbid VAULT_ID INDEX FROM AMOUNT</code></p>
<ul>
<li>
<p><code>VAULT_ID</code>: Vault id.</p>
</li>
<li>
<p><code>INDEX</code>: Auction index.</p>
</li>
<li>
<p><code>FROM</code>: Address to get tokens.</p>
</li>
<li>
<p><code>AMOUNT</code>: Amount of amount@symbol format.</p>
</li>
<li>
<p><code>TOTAL_PRICE</code> of token in auction will be locked up until the conclusion of the auction, or refunded when outbid.</p>
</li>
</ul>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../pinkpaper/interchain-exchange/fees.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../pinkpaper/operator/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../pinkpaper/interchain-exchange/fees.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../pinkpaper/operator/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
